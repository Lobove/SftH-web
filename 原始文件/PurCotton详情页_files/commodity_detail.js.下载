jQuery(document).ready(function($) {
   attention();
});

var gettitle = document.title.split(",", 1);
//QQ空间
function sharetoqzone() {
    window.open(
            'http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?desc='
                    + encodeURIComponent(gettitle + ' '
                            + document.location.href), '_blank');
}

//新浪
function sharetosina() {
    window.open('http://v.t.sina.com.cn/share/share.php?title='
                    + encodeURIComponent(gettitle + ' ' + location.href)
                    + '&amp;url=' + encodeURIComponent(location.href)
                    + '&amp;rcontent=' + encodeURIComponent(gettitle),
                    '_blank',
                    'scrollbars=no,width=600,height=450,left=75,top=20,status=no,resizable=yes');
}

//腾讯微博
function sharetoweibo() {
    window.open('http://v.t.qq.com/share/share.php?url='
            + encodeURIComponent(gettitle + ' ' + document.location.href),
            '_blank');
}

function addGoodsNo(id){
    var goodsObj = document.getElementById(id);
    var goodsNum = parseInt(goodsObj.value);
    goodsObj.value = ++goodsNum;
}

function cutGoodsNo(id){
    var goodsObj = document.getElementById(id);
    var goodsNum = parseInt(goodsObj.value);
    if(goodsNum==1){
        return;
    }else if(goodsNum == 0){
        goodsObj.value = 1;
        return;
    }
    goodsObj.value = --goodsNum;
}

function addCommodityCollect(){
    var url=MallPath+'/mall/collect/toAddCommondityCollect.ihtml';
    
    var prodNo=$('#prodNo').val();
    if(prodNo==""){
        return;
    }
    var params='&commodityId='+prodNo;
    
    $.ajax({ 
        type: "POST",
        url: url,
        data: params,
        success: function(msg){
            if(msg=="true"){
                $('body').popup({
                    title: '提示信息',
                    content: '收藏该货品成功！'
                });
                $('.goods-msg .to-buy .attention').addClass('heart-pink').text('已关注');
            }else if(msg=="noSession"){
                // content: '请先进行登录后再点击收藏！'
                alert_login ();
            }else if(msg=="false"){
                $('body').popup({
                    title: '提示信息',
                    content: '已收藏该货品！'
                });
                $('.goods-msg .to-buy .attention').addClass('heart-pink').text('已关注');
            }else{
                $('body').popup({
                    title: '提示信息',
                    content: '收藏该货品失败！'
                });
            }
        }
    });
}

function attention () {
    var url = MallPath + '/mall/collect/checkCommondityCollect.ihtml';
    
    var prodNo = $('#prodNo').val();
    if(prodNo == ""){
        return;
    }
    var params = '&commodityId=' + prodNo;
    
    $.ajax({ 
        type: "POST",
        url: url,
        data: params,
        success: function(msg){
			var message=eval("("+msg+")");
            if(message.success)
			{
                $('.goods-msg .to-buy .attention').addClass('heart-pink').text('已关注');
            }
        }
    });
}

function checkInput(str) {
    var pattern=/[`~!@#\$%\^\&\*\(\)_\+<>\?:"\{\},\.\\\/;'\[\]]/im;
    if(pattern.test(str))
    {
        return false;
    }
    return true;
}

function saveCollect(){
    var url=MallPath+'/mall/commodity/updateConsults.ihtml';
    
    var commoName=$('#commoName').val();
    var commoNo=$('#commoNo').val();
    var prodNo = $('#prodNo').val();
    var content=$('#invoice_content').val();
    if(prodNo==""){
        return;
    }
    if(content.trim()==""){
        alertBox("请输入您要咨询的内容!");
        return;
    }
    var params='&commoId='+commoNo+'&prodNo='+prodNo+'&commoName='+commoName+'&consultContent='+content;
    
    if(checkInput(content)){
        $.ajax({ 
            type: "POST",
            url: url,
            data: params,
            success: function(msg){
                if(msg=="true"){
                    alertBox("咨询成功!");
                    $('#invoice_content').val("");
                    closeCollect();
                }else if(msg=="noSession"){
                    alertBox("请先进行登录后再点击在线咨询!");
                }else{
                    alertBox("咨询失败!");
                }
            }
        });
    }else{
        alertBox("不能输入特殊字符!");
    }
}

String.prototype.trim=function(){
    return this.replace(/(^\s*)|(\s*$)/g, "");
 }

function getAjaxDataByProdNo(id){
    tpSwitch(id);
    sizeSwitch(id);
}
var colorPorp = "10000001";
var sizePorp =  "10000002";
function sizeSwitch(id){
    var url=MallPath+'/mall/commodity/getSizeProp.ihtml?productNo='+id;
    $.ajax({ 
        type: "POST",
        url: url,
        success: function(msg){
            var message=eval("("+msg+")");
            var str ="";    
            for ( var i = 0; i < message.length; i++) {
                if(i==0){
                    str+="<a data-id='10001' class='hover' data-value='"+message[i].value+"' href='javascript:void(0)' " +
                    "class='m5'>"+message[i].value+"<i class='ie6'></i></a>";
                }else{
                    str+="<a data-id='10001' data-value='"+message[i].value+"' href='javascript:void(0)' " +
                    "class='m5'>"+message[i].value+"<i class='ie6'></i></a>";
                }
                
            }
            $('#sizr_Prop').empty().html(str);
        }
    });
}

function tpSwitch(id){
//  ECW-Mall/mall/res/base/
    var url=MallPath+'/mall/commodity/getCommoPic.ihtml?productNo='+id;
    $.ajax({ 
        type: "POST",
        url: url,
        success: function(msg){
            var message=eval("("+msg+")");
            var str ="";    
            for ( var i = 0; i < message.length; i++) {
                if(i==0 && message[i].isDefault==1){
                    str+= "<li class='hover' jslogsrc='"+CommodityImgPath+"/"+message[i].picUrl+"' jqimg='"+CommodityImgPath+"/"+message[i].picUrl+"'><img src='"+CommodityImgPath+"/"+message[i].picUrl+"'/></li>";
                    $('#samllImg').attr('src',CommodityImgPath+"/"+message[i].picUrl);//中图
                    $('#samllImg').attr('jqimg',CommodityImgPath+"/"+message[i].picUrl);//放大镜图
                }
                else{
                    str+= "<li jslogsrc='"+CommodityImgPath+"/"+message[i].picUrl+"' jqimg='"+CommodityImgPath+"/"+message[i].picUrl+"'><img src='"+CommodityImgPath+"/"+message[i].picUrl+"'/></li>";
                }
                $('.nowss').empty().html(str);
                
            }
            qh();
        }
    });
}


//直减
var PREF_TYPE_MINUS_AMOUNT = "LR";
//打折
var PREF_TYPE_DISCOUNT = "DC";
//赠券
var PREF_TYPE_COUPON = "GT";
//赠品
var PREF_TYPE_GIFT = "GF";
//换购
var PREF_TYPE_EXCHANGE = "XC";
//包邮
var PREF_TYPE_FREE_DELIVERY = "PD";
//优惠价
var PREF_TYPE_PROMOTION_PRICE = "PP";
//特定件数，特定折扣（用于qm、gb的多买多折）
var PREF_TYPE_SPEC_QTY_SPEC_DISCOUNT = "SS";
//固定价格（可用于组合商品）
var PREF_TYPE_FIX_ITEM_PRICE = "FP";


$(document).ready(function(){
    
    addLeaguememberCookie(); //写官网网盟id到cookie中，在提交订单时候使用
    
    //ajax获取活动信息接口。
    var commoNo =$("#commoNo").val();
    var prodNo =$("#prodNo").val();
    var brandNo =$("#brandNo").val();
    var catNo =$("#catNo").val();
    var url= MallPath+"/mall/baseActivity/getBaseActivity.ihtml";
    var params='&commoNo='+commoNo+'&productNo='+prodNo+'&brandNo='+brandNo+'&catNo='+catNo;
    var str ="";
    var str1 ="";
    var strNewPC = "";
    var activity_str = "|";
    var activity_str_new_pc = "|";
    $.ajax({ 
        type: "POST",
        url: url,
        data: params,
        success: function(msg){
            var result = eval("("+msg+")");
            var prodMessageObj=result.prodMessage;
            /**对单个商品进行限购**/
            if(null!=prodMessageObj){
                /**货品货品名称，在货品名称后面加上限购件数*/
                var prodNameObj = $(".goods-tite").find("h5").eq(1);
                prodNameObj.append("(每个ID限购"+prodMessageObj.limitationQuantity+"件)");
                
                // PC改版使用
                var prodNameObj2 = $(".goods-msg").find(".detail");
                prodNameObj2.append("<span class=\"green\">  【每个ID限购" + prodMessageObj.limitationQuantity + "件】</span>");
            }
            var message=result.baseActivity;
            if(message.length==0){
                $("#discount").remove();
            }
            var limitCount = 1;
			var tmpOrigPri = $("#top_price").html();
            for ( var i = 0; i < message.length; i++) {
                if(message[i].type == "LTA"){
                    var activityMemberVoArray = message[i].members;
                    
                    var lta_price = message[i].rules[0].preferentialactions[0].preferentialValue;
                    var lta_discount = message[i].rules[0].preferentialactions[0].preferentialType;
                    if(lta_discount=="DC"){
                        lta_price = prodPrice*lta_price/10;
                    }
                    var level =  false;
                    
                    /**会员等级*/
                    if(null!=activityMemberVoArray&&null!=activityMemberVoArray[0]){
                        
                        var activityMember= activityMemberVoArray[0];
                        var memberType =  activityMember.memberType;
                        /**等级用户*/
                        if(memberType =="LEVEL"){
                            level  = true;
                        }
                    }
                    if(level){
                        str += "<span class='sbg'><i>"+message[i].activityName+"</i></span></br>";
                        str1="<li class='clearfix'><span class='leftli'>VIP价格：</span> <span class='price'>&yen;"
                            +parseFloat(lta_price).toFixed(1)+"</span></li>"
                            +"<input type='hidden' id='newProductPrice' name='newProductPrice' value='"+parseFloat(lta_price).toFixed(1)+"' />";
                        
                        // PC改版使用，刷新价格，活动价以及赠送的积分
                        $(".original-price").remove();
                        $(".price").append("<span class=\"discount-price\">VIP价格: &yen;" + parseFloat(lta_price).toFixed(1) + "</span>");
                        strNewPC += "<div><span class=\"tag-name\">【VIP活动】" + message[i].activityName + "</span></div>";
                        
                    }else{
                        /**原价格加虚线*/
                        $('span.price').addClass('tspan');
                        
                        str += "<span class='sbg'><i>"+message[i].activityName+"</i></span></br>";
                        str1="<li class='clearfix'><span class='leftli'>限时价格：</span> <span class='price'>&yen;"
                            +parseFloat(lta_price).toFixed(1)+"</span></li>"
                            +"<input type='hidden' id='newProductPrice' name='newProductPrice' value='"+parseFloat(lta_price).toFixed(1)+"' />";
                        $("#integral").html(Math.round(lta_price));
                        
                        // PC改版使用，刷新价格，活动价以及赠送的积分
                        $(".original-price").remove();
                        $("#top_price").html("&yen;" + parseFloat(lta_price).toFixed(1));
                        strNewPC += "<div><span class=\"tag-name\">【限时活动】" + message[i].activityName + "</span></div>";
                        
                        $('#orgPrice').addClass('original-price');
                        $("#actDiv").show();
                        $("#orgIntegral").remove();
                        $("#actIntegral").html("<span class=\"title\">赠送积分：</span>" + "<span id=\"integralSp\">${prodPrice.sellPrice?string(\"0\")?default(\"0\")}</span>");
                        $(".price .discount-price").html("&yen;" + parseFloat(lta_price).toFixed(1));
                        
						limitCount++;
                        
                        $("#integralSp").html(Math.round(lta_price));
                    }
                    
                    var result = parseFloat(lta_price).toFixed(1);
    
                    $("#zhj_00").html(result);
                    
                }else if(message[i].type == "BMHA"){
                    str += "<span class='sbg'><i>"+message[i].activityName+"</i></span></br>";
                    strNewPC += "<div><span class=\"tag-name\">【多买多折】" + message[i].activityName + "</span></div>";
                }else{
                    //$('span.price').removeClass('tspan');
                    for(var j=0;j<message[i].rules.length;j++){
                        if(message[i].activityName.indexOf('218元包邮') == -1 && message[i].activityName.indexOf('188元包邮') == -1){
                            if(activity_str.indexOf(message[i].activityName) == -1){
                                if(message[i].rules[j].preferentialactions[0].preferentialType == PREF_TYPE_MINUS_AMOUNT){
                                    str += "<span class='sbg'><i>"+message[i].activityName+"</i></span></br>";
                                }else if(message[i].rules[j].preferentialactions[0].preferentialType == PREF_TYPE_DISCOUNT){
                                    str += "<span class='sbg'><i>"+message[i].activityName+"</i></span></br>";
                                }else if(message[i].rules[j].preferentialactions[0].preferentialType == PREF_TYPE_COUPON){
                                    str += "<span class='sbg'><i>"+message[i].activityName+"</i></span></br>";
                                }else if(message[i].rules[j].preferentialactions[0].preferentialType == PREF_TYPE_GIFT){
                                    str += "<span class='sbg'><i>"+message[i].activityName+"</i></span></br>";
                                }else if(message[i].rules[j].preferentialactions[0].preferentialType == PREF_TYPE_EXCHANGE){
                                    str += "<span class='sbg'><i>"+message[i].activityName+"</i></span></br>";
                                }else{
                                    str += "<span class='sbg'><i>"+message[i].activityName+"</i></span></br>";
                                }
                                activity_str += message[i].activityName+"|";
                        }
                      }
                      
                      // PC改版使用
                      if(message[i].rules[j].preferentialactions[0].preferentialType != PREF_TYPE_FREE_DELIVERY)
                      {
                    	  if(activity_str_new_pc.indexOf(message[i].activityName) == -1)
                    	  {
                              if(message[i].rules[j].preferentialactions[0].preferentialType == PREF_TYPE_MINUS_AMOUNT)
                              {
                                  strNewPC += "<div><span class=\"tag-name\">【满减】" + message[i].activityName + "</span></div>";
                              }else if(message[i].rules[j].preferentialactions[0].preferentialType == PREF_TYPE_DISCOUNT)
                              {
                            	  strNewPC += "<div><span class=\"tag-name\">【满折】" + message[i].activityName + "</span></div>";
                              }else if(message[i].rules[j].preferentialactions[0].preferentialType == PREF_TYPE_COUPON)
                              {
                            	  strNewPC += "<div><span class=\"tag-name\">【满赠】" + message[i].activityName + "</span></div>";
                              }else if(message[i].rules[j].preferentialactions[0].preferentialType == PREF_TYPE_GIFT)
                              {
                            	  strNewPC += "<div><span class=\"tag-name\">【满赠】" + message[i].activityName + "</span></div>";
                              }else if(message[i].rules[j].preferentialactions[0].preferentialType == PREF_TYPE_EXCHANGE)
                              {
                            	  strNewPC += "<div><span class=\"tag-name\">【换购】" + message[i].activityName + "</span></div>";
                              }else
                              {
                            	  strNewPC += "<div><span class=\"tag-name\">【特价】" + message[i].activityName + "</span></div>";
                              }
                              activity_str_new_pc += message[i].activityName+"|";
                    	  }
                      }
                    }
                }
            }
            
            $('.dvs').empty().html(str);
            $('#actDivs').empty().html(strNewPC);
            $('ul.goodstiul-js li:first').after(str1);
            
            //pinyou单品统计2015-12-25 caohong
            getPinyouTJ();
            juxiaoTongji();
        }
    });
    
    var tujUl = $(".tuj").eq(1);
    if(tujUl[0]){
        var tujCheckedBox = tujUl.find("input:checked");
        tujCheckedBox.attr("checked",null);
    }
    //调评论function
    CountComments();
    $('#CommentsState').val(0);
    if(commoNo){
        pageNoClick(1,"pageComent");
        pageNo1Click(1,"commonid");
        
        pageNoClickNew(1,"pageComentNew"); // PC改版使用
    }
    
    //最近的浏览记录，后台无进行任何处理，无限增加
    //savelastCommodity(prodNo);
    
    //获取SKU库存数量
    getProductStock(prodNo);
    //获取已销售的数量
    //getCommoditySalesNum(commoNo);    
    getProdSalesNum(prodNo);
    //hping(500,452,12,5);//
});


//将网盟标识的写入cookie
function addLeaguememberCookie(){
    var url = window.location.href;
    var index = url.indexOf("?");
    var arg = url.substring(index+1, url.length); 
    var argArr = new Array();
    if(url.indexOf("&") != -1){
        argArr = arg.split("&");
    }else{
        argArr[0] = arg;
    }
    
    var leaguemember_Id = '';
    for(var i = 0 ; i < argArr.length; i++){
        if(argArr[i].indexOf("leaguemember_Id") != -1 || argArr[i].indexOf("leaguemember_id") != -1){
            leaguemember_Id = argArr[i].substring(16,argArr[i].legnth);
        }
    }
    //alert(leaguemember_Id);
    if(leaguemember_Id != ''){
        //var cookieLeaguememberId = getCookie('leaguemember_Id'); //读取cookie
        //如果已经存在cookie名为leaguemember_Id，先删除cookie保证网盟用户的独立
        //if(typeof cookieLeaguememberId != undefined && cookieLeaguememberId != null){
        //delCookie('leaguemember_Id'); //删除cookie
        //delCookie('yiqifa'); //删除领克特cookie
        //delCookie('LTINFO'); //删除亿起发cookie
        //}
        //setCookie("leaguemember_Id",leaguemember_Id);//添加cookie
    	var exp = new Date();
        exp.setTime(exp.getTime() - 1);    
        
        var leaguearr = new Array('leaguemember_Id','yiqifa','LTINFO','DUOMAI','WEIYI');
        for(var i in leaguearr){			
        	var arr = document.cookie.match(new RegExp("(^| )"+leaguearr[i]+"=([^;]*)(;|$)"));
            if (arr != null){
                document.cookie = leaguearr[i] + "=" + unescape(arr[2]) + ";expires=" + exp.toGMTString()+ ";path=/;domain=.purcotton.com";			
            }	
        }
        
        var exp = new Date();    //new Date("December 31, 9998");
        exp.setTime(exp.getTime() + 6 * 60 * 60 * 1000);//保存6个小时
        document.cookie = "leaguemember_Id=" + escape(leaguemember_Id) + ";expires=" + exp.toGMTString() + ";path=/;domain=.purcotton.com";   	
    }
}


function setCookie(name,value){//两个参数，一个是cookie的名子，一个是值 
    //var Days = 30; //此 cookie 将被保存 30 天
    var exp = new Date();    //new Date("December 31, 9998");
    exp.setTime(exp.getTime() + 6*60*60*1000);//保存6个小时
    document.cookie = name + "="+ escape (value) + ";expires=" + exp.toGMTString() + ";path=/";
}
function getCookie(name){//取cookies函数       
   var arr = document.cookie.match(new RegExp("(^| )"+name+"=([^;]*)(;|$)"));
   if(arr != null) return unescape(arr[2]); return null;
}
function delCookie(name){//删除cookie
    var exp = new Date();
    exp.setTime(exp.getTime() - 1);
    var cval=getCookie(name);
    if(cval!=null) document.cookie= name + "="+cval+";expires="+exp.toGMTString();
}


//存储浏览记录
function savelastCommodity(prodNo){
    var savelastUrl = MallPath+"/mall/commodity/savelastCommodityMap.ihtml";
    
    $.ajax({ 
        type: "POST",
        url: savelastUrl+"?prodNo="+prodNo,
        success: function(msg){
            
        }
    });
}

//获取SKU库存数量
function getProductStock(prodNo){
    var url = MallPath+"/mall/commodity/getProductStock.ihtml";
    
    $.ajax({ 
        type: "POST",
        url: url+"?productNo="+prodNo,
        success: function(msg){
            $("#productStock").val(msg);
            $("#stockId").html("库存"+msg+"件");
            if(msg==0)
            {
                if(document.getElementById("stockDIV0"))
                {
                    document.getElementById("stockDIV0").style.display="block";
                }
                if(document.getElementById("stockDIV"))
                {
                    document.getElementById("stockDIV").style.display="none";
                }
                if(document.getElementById("zuheDIV0"))
                {
                    document.getElementById("zuheDIV0").style.display="block";
                }
                if(document.getElementById("zuheDIV"))
                {
                    document.getElementById("zuheDIV").style.display="none";
                }
                
                $("#jrcarR").remove();//不显示商品介绍处的立即购买
                
                // PC改版使用  Begin
                $("#jCard").removeClass("btn-green").removeClass("jiacar");
                $("#jCard").addClass("btn-gray").addClass("disabled");
                $("#jCard").attr("disabled",true);
                
                $("#bNow").hide();
                
                // PC改版使用  End
            }
        }
    });
}

//获取SKU库存数量
function getCommoditySalesNum(commoNo){
    var url = MallPath+"/mall/commodity/getCommoditySalesNum.ihtml";
    
    $.ajax({ 
        type: "POST",
        url: url+"?CommoNo="+commoNo,
        success: function(msg){
            $("#salesNum").html("已售"+msg+"件");
        }
    });
}

function getProdSalesNum(prodNo){
    var url = MallPath+"/mall/commodity/getProdSalesNum.ihtml";
    
    $.ajax({ 
        type: "POST",
        url: url+"?ProdNo="+prodNo,
        success: function(msg){
            $("#salesNum").html("已售"+msg+"件");
        }
    });
}


//获取评论的数据。
function CountComments(){
    var commodityCommentCountUrl = MallPath+"/mall/commodity/getCommentsCountNum.ihtml";
    var commoNo = $("#commoNo").val();
    
    $.ajax({ 
        type: "POST",
        url: commodityCommentCountUrl+"?commoNo="+commoNo,
        success: function(msg){
            var message=eval("("+msg+")");
            hping(message.total,message.goodNum,message.generalNum,message.inferiorNum);
            $("#qb00").text("全部（"+message.total+"）");
            $("#hp00").text("好评（"+message.goodNum+"）");
            $("#zp00").text("中评（"+message.generalNum+"）");
            $("#cp00").text("差评（"+message.inferiorNum+"）");
            $("#countpp").text(message.total+"人参与评分");
        }
    });
}

function pageNoClick(pageNo,id){
    var url = MallPath + "/mall/commodity/getComments.ihtml";
    var params='&page='+pageNo;
    
    var state = $('#CommentsState').val();

    var commoNo = $('#commoNo').val();
    if(state==null || state==""){
        
    }else{
        params+='&state='+state;
    }
    
    if(commoNo==null || commoNo==""){
        
    }else{
        params+='&commoNo='+commoNo;
    }
    $.ajax({ 
        type: "POST",
        url: url,
        data: params,
        success: function(msg){
            $("#pageComentdl").children().remove();
            //$("#pageComentdl").remove();
            //alert(msg);
            var result=eval("("+msg+")");
            
            if(null!=result){
                var item = result.rows;
                
                pageFunction(result.pageNo,result.total,result.pageSize,true,id);
                if(item==""){
                    //将分页控件移除
                    //$("#pageComent").children().remove(); 
                    var str = "<div style=\"text-align:center\"><i class=\"no_propt\">暂无商品评价!</i></div>";
                    $("#pageComentdl").append(str);
                }else{
                    for(var i = 0;i<item.length;i++){
                        var memberpic = item[i].memberPic;
                        var memberName = item[i].memberName;
                        if(typeof(memberpic) == "undefined" || memberpic == ""){
                            memberpic = "/res/base/images/to1.jpg";
                        }
                        if(typeof(memberName) == "undefined" || memberName == ""){
                            memberName = "qm_"+item[i].memberNo.substr(6);
                        }
						
						if(memberName.length > 1)
						{
							memberName = memberName.substr(0,1) + "**" + memberName.substr(memberName.length - 1);
						}else
						{
							memberName = memberName + "**";
						}
						
                        var str = "";
                        str+="<dl class='clearfix gdl'> <dt><img src='" + MallPath + "/" + memberpic + "'/>";
                        if($("#pageComentdl").hasClass("group-buy"))
                            str+="<a href='#'>"+memberName+"</a></dt><dd style='width:640px;'><i class='ddi'></i><div class='clearfix'>";
                        else
                            str+="<a href='#'>"+memberName+"</a></dt><dd><i class='ddi'></i><div class='clearfix'>";
                        if(item[i].commentScore==5){
                            str+="<span class='ddspan'>评分：</span><em class='xl_6'></em></div>";
                        }else if(item[i].commentScore==4){
                            str+="<span class='ddspan'>评分：</span><em class='xl_5'></em></div>";
                        }else if(item[i].commentScore==3){
                            str+="<span class='ddspan'>评分：</span><em class='xl_4'></em></div>";
                        }else if(item[i].commentScore==2){
                            str+="<span class='ddspan'>评分：</span><em class='xl_3'></em></div>";
                        }else{
                            str+="<span class='ddspan'>评分：</span><em class='xl_2'></em></div>";
                        }
                        
                        str+="<div class='clearfix'><span class='ddspan'>评价内容：</span><p class='cmt'>"+item[i].commentContent+"</p><span class='dtgy mt0'>"+item[i].createTime+"</span></div>";
                        if(item[i].rContent!=null && item[i].rContent!=""){
                            str+="<h5 class='dd-h5 csz'><span class='eoc-rp'> 全棉回复：</span><span class='eoc-rc'>"+item[i].rContent+"</span></h5><span class='dtgy'>"+item[i].rTime+"</span></dd></dl>";
                        }
                        $("#pageComentdl").append(str);
                    }
                }
            }
        }
    });
}

function pageNoClickNew(pageNo,id){
    var url = MallPath + "/mall/commodity/getComments.ihtml";
    var params = '&page=' + pageNo;
    var state = $('#CommentsState').val();
    var commoNo = $('#commoNo').val();
    if(state == null || state == "")
    {
        
    }else
    {
        params+='&state='+state;
    }
    
    if(commoNo==null || commoNo=="")
    {
        
    }else
    {
        params+='&commoNo='+commoNo;
    }
    $.ajax({ 
        type: "POST",
        url: url,
        data: params,
        success: function(msg){
            $("#pageComentdlNew").children().remove();
            var result=eval("("+msg+")");
            if(null!=result)
            {
                var item = result.rows;
                pageFunctionNew(result.pageNo,result.total,result.pageSize,true,id);
                if(item=="")
                {
                    //将分页控件移除
                    //$("#pageComent").children().remove(); 
                    var str = "<div style=\"text-align:center\"><i class=\"no_propt\">暂无商品评价!</i></div>";
                    $("#pageComentdlNew").append(str);
                }else
                {
                    for(var i = 0;i<item.length;i++)
                    {
                        var memberpic = item[i].memberPic;
                        var memberName = item[i].memberName;
                        if(typeof(memberpic) == "undefined" || memberpic == "")
                        {
                            memberpic = "/res/base/images/to1.jpg";
                        }
                        if(typeof(memberName) == "undefined" || memberName == "")
                        {
                            memberName = "qm_"+item[i].memberNo.substr(6);
                        }
						
						if(memberName.length > 1)
						{
							memberName = memberName.substr(0,1) + "**" + memberName.substr(memberName.length - 1);
						}else
						{
							memberName = memberName + "**";
						}
						
                        var str = "";
                        str+="<dl class='clearfix'> <dt> <div class='head'><img src='" + MallPath + "/" + memberpic + "'/></div>";
                        if($("#pageComentdlNew").hasClass("group-buy"))
                            str+="<div class='name'>"+memberName+"</div></dt><dd style='width:640px;'><i class='ddi'></i><div class='clearfix'>";
                        else
                            str+="<div class='name'>"+memberName+"</div></dt><dd><div class='star clearfix'><div class='left clearfix'>";
                        if(item[i].commentScore==5)
                        {
                            str+="<span class='word left'>评分：</span><i class='star5'></i></div>";
                        }else if(item[i].commentScore==4)
                        {
                            str+="<span class='word left'>评分：</span><i class='star4'></i></div>";
                        }else if(item[i].commentScore==3)
                        {
                            str+="<span class='word left'>评分：</span><i class='star3'></i></div>";
                        }else if(item[i].commentScore==2)
                        {
                            str+="<span class='word left'>评分：</span><i class='star2'></i></div>";
                        }else
                        {
                            str+="<span class='word left'>评分：</span><i class='star1'></i></div>";
                        }
                        
                        str += "<div class='right'><span class='word'>" + item[i].createTime + "</span></div></div>";
                        
                        str+="<div class='content'><span class='word'>评价内容：</span><span>" + item[i].commentContent + "</span></div>";
                        if(item[i].rContent != null && item[i].rContent != "")
                        {
                            str+="<div class='reply'><span class='word green'>全棉回复：</span><span>" + item[i].rContent + "</span></div></dd></dl>";
                        }
                        $("#pageComentdlNew").append(str);
                    }
                }
            }
        }
    });
}

function pageNo1Click(pageNo,id){
    var url = MallPath+"/mall/commodity/getConsults.ihtml";
    var params='&page='+pageNo;
    
    var commoNo = $('#commoNo').val();
    if(commoNo==null || commoNo==""){
        
    }else{
        params+='&commoId='+commoNo;
    }
    
    $.ajax({ 
        type: "POST",
        url: url,
        data: params,
        success: function(msg){
            $("#pagelist").children().remove();

            
            var result=eval("("+msg+")");
                        
            if(null!=result){
                var item = result.rows;

                pageFunction(result.pageNo,result.total,result.pageSize,true,id);
                if(item == ""){
                    //将分页控件移除
                    //$("#pageComent").children().remove(); 
                    var str = "<div style=\"text-align:center\"><i class=\"no_propt\">暂无商品咨询!</i></div>";
                    $("#pagelist").append(str);
                }else{
                    for(var i = 0;i<item.length;i++){
                        var memberpic = item[i].memberPic;
                        var memberName = item[i].memberName;
                        if(typeof(memberpic) == "undefined" || memberpic == ""){
                            memberpic = "/res/base/images/to1.jpg";
                        }
                        if(typeof(memberName) == "undefined" || memberName == ""){
                            memberName = "qm_"+item[i].memberNo.substr(6);
                        }
						
						if(memberName.length > 1)
						{
							memberName = memberName.substr(0,1) + "**" + memberName.substr(memberName.length - 1);
						}else
						{
							memberName = memberName + "**";
						}
						
                        var str = "";
                        str+="<dl class='clearfix gdl'> <dt><img src='" + MallPath + "/" + memberpic + "'/>";
                        if($("#pagelist").hasClass("group-buy"))
                            str+="<a href='#'>"+memberName+"</a></dt><dd style='width:640px;'><i class='ddi'></i>";
                        else
                            str+="<a href='#'>"+memberName+"</a></dt><dd><i class='ddi'></i>";
                        //str+="<span class='ddspan'>评分：</span><em class='gdlpf'></em></div>";
                        
                        str+="<div class='clearfix'><span class='ddspan'>咨询内容：</span><p class='cmt'>"+item[i].consultContent+"</p><span class='dtgy mt0'>"+item[i].createTime+"</span></div>";
                        
                        if(item[i].rContent!=null && item[i].rContent!=""){
                            str+="<h5 class='dd-h5 csz'><span class='eoc-rp'>全棉回复：</span><span class='eoc-rc'>"+item[i].rContent+"</span></h5><span class='dtgy'>"+item[i].rTime+"</span></dd></dl>";
                        }
                        
                        $("#pagelist").append(str);
                    }
                }
            }
        }
    });
}

//var totalRows;
//var PageSize;
var totalPage;


//点击触发该方法
function queryPage(pageNo,id,totalRows,PageSize){
    totalPage=Math.ceil(totalRows/PageSize);
    if(pageNo==0){
        alertBox("已经是第一页!");
        return;
    }
    
    if(pageNo>totalPage){
        alertBox("已经到最后一页!");
        return ;
    }
/*  if(isNaN(pageSize)){
        alertBox('每页条数只能为数字');
        return ;
    }
    var totalPage=Math.ceil(totalRows/pageSize);
    var toPage=pageNo;
    if(pageNo==0){
        //toPage=document.getElementById("query.page").value;
        //if(isNaN(toPage) || toPage<=0){
        //  alertBox("请输入大于0的整数.");
        //  return false;
        //}
        //if(toPage>totalPage){
        //  alertBox("没有当前页数");
        //  return false;
        //}
        return ;
    }
    //校验是跳转页是否在记录有效范围内
    //取大于等于总页数的值
    if(toPage>totalPage){
        alertBox("已经到最后一页");
        return ;
    }*/
    if(id=="pageComent"){
        pageNoClick(pageNo,id); //提供外部调用
    }else{
        pageNo1Click(pageNo,id); //提供外部调用
    }
    
}

/**
*调用显示分页
*pageNo 第几页，  rowCount 总共有多少条页数 ， pageSize每页显示多少条数据，hasPrevious，是否显示分页
*/

function pageFunction(pageNo,rowCount,pageSize,hasPrevious,pageComentId){
    
    //rowCount = rowCount+1;
    //totalRows = rowCount;
    //PageSize = pageSize;
    //将分页控件移除
    $("#"+pageComentId).children().remove();
    
    var pageCount = 1;
    if(rowCount%pageSize==0){
        pageCount = rowCount/pageSize;
    }else{
        pageCount= Math.ceil(rowCount/pageSize);
    }
    //alertBox(pageCount);
    //return ;
    var pageKongjian = "";
    if(rowCount>0){ 
        pageKongjian = pageKongjian + "<a class='toll' >"+pageNo+"/"+pageCount+"</a>";
        if(pageNo==1){
            pageKongjian = pageKongjian + "<a href='javascript:queryPage(1,\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' class='shoye' id='"+pageComentId+"00'>首页</a>";
        }else{
            pageKongjian = pageKongjian + "<a href='javascript:queryPage(1,\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' id='"+pageComentId+"00'>首页</a>";
        }
        
        if(pageCount>1){
            var pageTempNo= pageCount-pageNo;
            if(hasPrevious == false){
                pageKongjian = pageKongjian + "<span class='page-pre-no'></span>";
            }else{
                var sPageNo = pageNo-1;
                pageKongjian = pageKongjian + "<a href='javascript:queryPage("+sPageNo+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' title='上一页'>上一页</a>";
            }
            if(pageCount<10){
                
                for(var i = 1;i<= pageCount;i++){   //选中时的样式 
                    if(pageNo==i){
                        pageKongjian = pageKongjian + "<a href='javascript:queryPage("+i+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' class='shoye' >"+i+"</a>";
                    }else{
                        pageKongjian = pageKongjian + "<a href='javascript:queryPage("+i+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' >"+i+"</a>";
                    }
                }
            }else if(pageTempNo<5){
            
                for(var i = 1;i< 10;i++){
                    var count = pageCount - 9 + i;
                    if((pageCount-pageNo)==(9-i)){//选中时的样式 
                        pageKongjian = pageKongjian + "<a href='javascript:queryPage("+count+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' class='shoye'>"+count+"</a>";
                    }else{//默认的样式
                        
                        pageKongjian = pageKongjian + "<a href='javascript:queryPage("+count+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")'> "+count+"</a>";
                    }                   
                }
                
            }else{
            
                for(var row = 1;row < 11;row++){
                    if(row==8){
                        pageKongjian = pageKongjian + "<a>  ...</a>";
                    }else if(row==9){
                        var pageCountTemp = pageCount -1;
                        pageKongjian = pageKongjian + "<a href='javascript:queryPage("+pageCountTemp+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")'  >"+pageCountTemp+" </a>";
                    }else if(row==10){
                        pageKongjian = pageKongjian + "<a href='javascript:queryPage("+pageCount+",\""+pageComentId+"\")',\""+rowCount+"\",\""+pageSize+"\" > "+pageCount+"</a>";
                        
                    }else{
                        
                        if(pageNo < 5){
                            
                            if(pageNo == row){
                                
                                pageKongjian = pageKongjian + "<a href='javascript:queryPage("+row+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\");' class='shoye' > "+row+"</a>";
                            }else{
                            
                                pageKongjian = pageKongjian + "<a href='javascript:queryPage("+row+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\");' >"+row+"</a>";
                            }
                        }else {
                            var pageNoTemp = pageNo-4+row;
                            if(row == 4){
                                pageKongjian = pageKongjian + "<a href='javascript:queryPage("+pageNoTemp+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' class='shoye' >"+pageNoTemp+"</a>";
                            }else{
                                pageKongjian = pageKongjian + "<a href='javascript:queryPage("+pageNoTemp+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")'> "+pageNoTemp+"</a>";
                            }
                        }
                        
                    }               
                }
        
            }
    
        }
        
        if(hasPrevious == false){
            pageKongjian = pageKongjian + "<span class='page-next-no'></span>";
        }else{
            var temp= pageNo +1;
            pageKongjian = pageKongjian + "<a href='javascript:queryPage("+temp+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")'   title='下一页'  >下一页</a>";
        }
        
        if(pageNo==totalPage){
            pageKongjian = pageKongjian + "<a href='javascript:queryPage("+pageCount+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' class='shoye' id='"+pageComentId+"11' >尾页</a>   ";
        }else{
            pageKongjian = pageKongjian + "<a href='javascript:queryPage("+pageCount+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' id='"+pageComentId+"11' >尾页</a> ";
        }
    }else{
        
    }
    
    $("#"+pageComentId).append(pageKongjian);   
    //return pageKongjian;
}

//点击触发该方法
function queryPageNew(pageNo,id,totalRows,PageSize){
    totalPage = Math.ceil(totalRows/PageSize);
    if(pageNo == 0)
    {
        alert("已经是第一页!");
        return;
    }
    
    if(pageNo > totalPage)
    {
        alert("已经到最后一页!");
        return ;
    }
    pageNoClickNew(pageNo,id);
}

function pageFunctionNew(pageNo,rowCount,pageSize,hasPrevious,pageComentId){
    $("#" + pageComentId).children().remove();
    var pageCount = 1;
    var totalPage = Math.ceil(rowCount/pageSize);
    if(rowCount%pageSize == 0)
    {
        pageCount = rowCount/pageSize;
    }else
    {
        pageCount= Math.ceil(rowCount/pageSize);
    }
    var pageKongjian = "";
    if(rowCount > 0)
    {
        if(pageCount > 1)
        {
        	if(pageNo > 1)
            {
        		pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+(pageNo - 1)+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' class='prev'><span class='go'>&lt;</span> 上一页</a>";
            }
            var pageTempNo = pageCount - pageNo;
            if(pageCount < 10)
            {
                for(var i = 1;i <= pageCount;i++)
                {   //选中时的样式 
                    if(pageNo == i)
                    {
                        pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+i+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' class='cur' >"+i+"</a>";
                    }else
                    {
                        pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+i+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' >"+i+"</a>";
                    }
                }
            }else if(pageTempNo < 5)
            {
                for(var i = 1;i< 10;i++)
                {
                    var count = pageCount - 9 + i;
                    if((pageCount-pageNo) == (9-i))
                    {//选中时的样式 
                        pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+count+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' class='cur'>"+count+"</a>";
                    }else
                    {//默认的样式
                    	if(i == 1)
                    	{
                    		pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+i+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\");' >"+i+"</a>";
                    	}else if(i == 2)
                    	{
                    		pageKongjian = pageKongjian + "<a>  ...</a>";
                    	}else
                    	{
                    		pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+count+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")'> "+count+"</a>";
                    	}
                        
                    }                   
                }
            }else
            {
                for(var row = 1;row < 11;row++)
                {
                    if(row == 8)
                    {
                        pageKongjian = pageKongjian + "<a>  ...</a>";
                    }else if(row == 9)
                    {
                        var pageCountTemp = pageCount -1;
                        pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+pageCountTemp+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")'  >"+pageCountTemp+" </a>";
                    }else if(row == 10)
                    {
                        pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+pageCount+",\""+pageComentId+"\")',\""+rowCount+"\",\""+pageSize+"\" > "+pageCount+"</a>";
                    }else
                    {
                        if(pageNo < 5)
                        {
                            if(pageNo == row)
                            {
                                pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+row+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\");' class='cur' > "+row+"</a>";
                            }else
                            {
                                pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+row+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\");' >"+row+"</a>";
                            }
                        }else 
                        {
                        	if(row == 1)
                        	{
                        		pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+row+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\");' >"+row+"</a>";
                        	}else if(row == 2)
                        	{
                        		pageKongjian = pageKongjian + "<a>  ...</a>";
                        	}else
                        	{
                        		var pageNoTemp = pageNo - 4 + row;
                                if(row == 4)
                                {
                                    pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+pageNoTemp+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' class='cur' >"+pageNoTemp+"</a>";
                                }else
                                {
                                    pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+pageNoTemp+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")'> "+pageNoTemp+"</a>";
                                }
                        	}
                        }
                    }               
                }
            }
            if(pageNo < totalPage)
            {
            	pageKongjian = pageKongjian + "<a href='javascript:queryPageNew("+(pageNo + 1)+",\""+pageComentId+"\",\""+rowCount+"\",\""+pageSize+"\")' class='next'>下一页 <span class='go'>&gt;</span></a>";
            }
        }else
        {
        	pageKongjian = pageKongjian + "<a href='javascript:;' class='cur'>1</a>";
        }
    }else
    {
        
    }
    $("#"+pageComentId).append(pageKongjian);   
}

//单品加入购物车
var index = 0;

function addCartAnimation(arr, idx, jia, cart){
    //loginBox();
    $('body').popup({
        title: '信息',
        content: '加入购物车成功！'
    });
    /*arr = $(document.createElement("div"));
    arr.addClass("goods-pic").attr("id", "goodsPic" + idx).css({
        left : jia.position().left + (jia.width() - 25) / 2 + "px",
        top : jia.position().top + (jia.height() - 25) / 2 + "px"
    });
    $("body").append(arr);
    arr = $(document.getElementById("goodsPic" + idx));
    arr.animate({
        left : cart.position().left + 8 + "px",
        top : cart.position().top + parseInt(cart.css("marginTop")) + (cart.height() - 25) / 2 + "px"
    }, "slow", function(){
        $(this).fadeOut();
        $(this).remove();
    }); */
}

function addcart(prodNo,num,leagueCommo){
    var locationUrl = window.location.href;
    var leagueCommoStr = $('#'+leagueCommo).val();
    if(typeof leagueCommoStr == "undefined" || leagueCommoStr == ""){
        if(locationUrl.indexOf("?leaguemember_Id=") != -1) {
            leagueCommoStr = locationUrl.substring(locationUrl.indexOf("?leaguemember_Id=")+17);
        }
    }
    var jiacar = $(".jiacar"),
        topCart = $(".top-cart"),
        goodsArray = [];
    
    var numobj = $('#'+num).val();
    var stock = $("#productStock").val();
    
    if(!isNaN(numobj)){
        
    }
    
    if(numobj<=0){
        // alertBox("请输入正确的购物数量!");
		$('body').popup({
			title: '提示信息',
			content: '请输入正确的购物数量！'
		});
        $('#'+num).focus();
        return;
    }
    
    if(parseInt(numobj)>parseInt(stock)){
        // alertBox("请输入小于或等于库存的购物数量!");
		$('body').popup({
			title: '提示信息',
			content: '请输入小于或等于库存的购物数量！'
		});
        $('#'+num).focus();return;
    }
            
    var url=MallPath+"/mall/cart/add_cart.ihtml?sellType=1&prodNo="+$('#'+prodNo).val()+"&num="+$('#'+num).val()+"&leagueCommo="+leagueCommoStr;
        $.ajax({ 
                type: "POST",
                url: url,
                success: function(msg){
                    if(msg=='success'){
                        //var catNum = parseInt($('#catNum').html());
                        //var goodsNum = parseInt($('#goodsNo').val());
                        //catNum += goodsNum;
                        //$('#catNum').html(catNum);
                        /*$.getJSON(MallPath + "/mall/main/getCatNum.ihtml", function(json) {
                            var number = json.listData;
                            console.log(number);
                            $("#catNum").html(number);
                        });*/
                        $.ajax({
                            url : MallPath + "/mall/main/getCatNum.ihtml?timestamp=" + new Date().getTime(),
                            async : false,
                            dataType : "json",
                            success : function(json){
                                var number = json.listData;
                                // $("#catNum").html(number);
                                if (number > 99) {
                                    $("#catNum").html('99+').addClass('cat-num-l');
                                }else {
                                    $("#catNum").html(number).removeClass('cat-num-l');
                                }
                            }
                        });
                        
                        addCartAnimation(goodsArray[index], index++, jiacar, topCart);
                        if(index >= 5000)
                            index = 0;
                        //alertBox('您选中的商品已添加到购物车!');
                    }else{
                        // alertBox('您选中的商品添加失败!');
						$('body').popup({
							title: '提示信息',
							content: '您选中的商品添加失败！'
						});
                    }                       
                }
            });
        }




//推荐组合包加入购物车
function addPackCart(){
    
    var jiacar = $(".buyzuhe"),
    topCart = $(".top-cart"),
    goodsArray = [];
    
    var tujUl = $(".tuj").eq(1);
    var prodNo = $("#prodNo").val();
    var tujCheckedBox = tujUl.find("input:checked");
    var prodStr=prodNo+",";
    tujCheckedBox.each(function(){
        prodStr+=$(this).attr("id")+",";
    });
    prodStr = prodStr.substring(0,prodStr.length-1);//去最后的逗号,
    
    var url=MallPath+"/mall/cart/add_prods.ihtml?prods="+prodStr;
        $.ajax({ 
            type: "POST",
              url: url,
            success: function(msg){
                if(msg=='success'){
                        
                    $.getJSON(MallPath + "/mall/main/getCatNum.ihtml", function(json) {
                        var num = json.listData;
                        // $("#catNum").html(num);
                        if (num > 99) {
                            $("#catNum").html('99+').addClass('cat-num-l');
                        }else {
                            $("#catNum").html(num).removeClass('cat-num-l');
                        }
                    });
                        
                    addCartAnimation(goodsArray[index], index++, jiacar, topCart);
                    if(index >= 5000)
                        index = 0;
                    //alertBox('您选中的商品已添加到购物车!');
                }else{
                    // alertBox('您选中的商品添加失败!');
                    $('body').popup({
                        title: '提示信息',
                        content: '您选中的商品添加失败！'
                    });
                }                       
            }
        });
}
//动态改变加入组合包货品后的价格
function updatePackPrice(obj){
    var zhPrice = $("#zhj_00");
    var resultPrice;
    if(obj.checked){
        resultPrice = parseFloat(zhPrice.html())+parseFloat(obj.value);
        //加 
        zhPrice.html(parseFloat(resultPrice).toFixed(1));
         
    }else{
        resultPrice = parseFloat(zhPrice.html())-parseFloat(obj.value);
        zhPrice.html(parseFloat(resultPrice).toFixed(1));
    }
}

function switchHTML(parameter,type,obj){
    if(type == 100){
        /**原始选中数据，判断是否选中的原始数据*/
        var original = $(obj).parent().find('.hover').attr("data-value");
        if(original == parameter){
            return;
        }
        /***将原始选中的文本框去掉，将点击的文本框加上**/
        $(obj).parent().find('.hover').removeClass('hover');
        $(obj).addClass("hover");
        
        var url = MallPath+"/mall/commodity/getCommodityDetail.ihtml?prodNo=";
        var propListNos = "";
        /**通过each遍历，获得已选择的属性*/
        $("#propListId a").each(function(index, element) {
            /**获取已选中的值*/
            if($(this).hasClass('hover')){  
                propListNos = propListNos+","+$(this).attr("data-value");
            }   
        });
        propListNos =  propListNos.substring(1);
        
        var _theArray = propListNos.split(",");
        
        /**获取当前选中的属性，对应货品信息*/
        for(var i = 0;i<customProductProps.length;i++){ 
        
            var productProps = customProductProps[i];   
            var prodNo =  productProps.prodNo;          
            var number = prodNo.substring(productProps.prodNo.length-3); 
            if(null!=productProps.propsValues&&""!=productProps.propsValues){
                var propsValues = productProps.propsValues ;    
                var temp  = true;
                for ( var int = 0; int < _theArray.length; int++) { 
                    if(propsValues.indexOf(_theArray[int])<0){                      
                        //propNoTemp = propNoTemp.replace(propsValues, ""); 
                        temp = false;
                        break;
                    }
                }
                if(temp){
                    if(debug==1){
                        url = MallPath + "/detail/"+number+"/"+productProps.prodNo+".html";
                        window.location.href = url;
                        return;
                    }else{
                        window.location.href = url+prodNo;
                        return;
                    }
                }
            }
        }
    }else{
        if(type==1){
            $("#colorPropNo").val(parameter);
        }else{
            $("#sizePropNo").val(parameter);
        }
    
        var prodNo = $("#prodNo").val();        //页面初始加载的货品编号
        
        var colorProp = $("#colorPropNo").val();//选中的颜色规格编号
        var sizeProp = $("#sizePropNo").val();  //选择的尺寸规格编号
        
        var url = MallPath+"/mall/commodity/getCommodityDetail.ihtml?prodNo=";
    
        for(var i = 0;i<customProductProps.length;i++){
            var productProps = customProductProps[i];
            var number = productProps.prodNo.substr(productProps.prodNo.length-3);
            if(null!=colorProp&&null!=sizeProp){
                if(productProps.colorProp!=null && productProps.sizeProp!=null){
                    if(productProps.colorProp==colorProp && productProps.sizeProp==sizeProp){
                        if(prodNo == productProps.prodNo){
                            return;
                        }
                        
                        number=productProps.prodNo.substr(productProps.prodNo.length-3);
                        if(debug==1){
                            url = MallPath + "/detail/"+number+"/"+productProps.prodNo+".html";
                            window.location.href = url;
                            return;
                        }else{
                            window.location.href = url+productProps.prodNo;
                            return;
                        }
                    }
                }
            }else if (null!=colorProp){
                if(null!=productProps.colorProp&&productProps.colorProp==colorProp){
                    //alert("您选择的货品编号为："+productProps.prodNo);
                    if(prodNo == productProps.prodNo){
                        return;
                    }
                    if(debug==1){
                        url = MallPath + "/detail/"+number+"/"+productProps.prodNo+".html";
                        window.location.href = url;
                        return;
                    }else{
                        window.location.href = url+productProps.prodNo;
                        return;
                    }
                }
            }else if(null!=sizeProp){
                if(null!=productProps.sizeProp&&productProps.sizeProp==sizeProp){
                    //alert("您选择的货品编号为："+productProps.prodNo);
                    if(prodNo == productProps.prodNo){
                        return;
                    }
                    if(debug==1){
                        url = MallPath + "/detail/"+number+"/"+productProps.prodNo+".html";
                        window.location.href = url;
                        return;
                    }else{
                        window.location.href = url+productProps.prodNo;
                        return;
                    }
                }
            }
            
            
            /*if(productProps.colorProp!=null && productProps.sizeProp!=null){
                if(productProps.colorProp==colorProp && productProps.sizeProp==sizeProp){
                    if(prodNo == productProps.prodNo){
                        return;
                    }
                    
                    if(debug==1){
                        url = MallPath + "/detail/"+number+"/"+productProps.prodNo+".html";
                        window.location.href = url;
                        return;
                    }else{
                        window.location.href = url+productProps.prodNo;
                    }
                }
            }else{
                if(productProps.colorProp==null){
                    if(productProps.sizeProp==sizeProp){
                        //alert("您选择的货品编号为："+productProps.prodNo);
                        if(prodNo == productProps.prodNo){
                            return;
                        }
                        if(debug==1){
                            url = MallPath + "/detail/"+number+"/"+productProps.prodNo+".html";
                            window.location.href = url;
                            return;
                        }else{
                            window.location.href = url+productProps.prodNo;
                        }
                    }
                }else{
                    if(productProps.colorProp==colorProp){
                        //alert("您选择的货品编号为："+productProps.prodNo);
                        if(prodNo == productProps.prodNo){
                            return;
                        }
                        if(debug==1){
                            url = MallPath + "/detail/"+number+"/"+productProps.prodNo+".html";
                            window.location.href = url;
                            return;
                        }else{
                            window.location.href = url+productProps.prodNo;
                        }
                    }
                }
            }*/
        }
    }
}

function loginBox(){
    var mask_div, login_div;
    if(document.getElementById("login-div")){
        mask_div = $$("mask-div");
        login_div = $$("login-div");
        login_div.show();
        mask_div.show();    
    }else{
        var str = "<div id=\"login-div\" style=\"width:600px; z-index:1999; position:fixed;\">";
            str += "<div class=\"confirm-title\"><span>网页提示</span><a id=\"cf_close\" href=\"javascript:void(0);\"></a></div>";
            str += "<div class=\"log-cent clearfix\" style=\"width:600px;background:#fff\">";
            str += "<a href=\"javascript:void(0)\" class=\"login-adv1\" title=\"全棉\">";
            str += "<img src=\"../../res/base/images/login-adv-s.jpg\" alt=\"全棉\" />";
            str += "</a><div class=\"login-form1\"><span class=\"tt-t\">";
            str += "还没有注册？<a href=\"http://localhost:8080/ECW-Mall/mall/memberLogin/toRegister.ihtml\">免费注册</a></span>";
            str += "<form action=\"login.ihtml\" method=\"post\" onSubmit=\"return loginShop()\"  name=\"login\" id=\"login\" >";
            str += "<span class=\"t\"></span><ul class=\"login-ul1\">";
            str += "<li><span>已验证手机</span><input type=\"text\" id=\"loginName\" name=\"loginName\" class=\"text4\" /></li>";
            str += "<li><span>密码</span><input type=\"password\" id=\"loginPassword\" name=\"loginPassword\" class=\"text4\" /></li>";
            str += "<div style=\"line-height:20px;padding-left:75px\"><span id=\"warn\" style=\"color:red\"></span></div>";
            str += "<li><input type=\"checkbox\" id=\"zdt\" /><label for=\"zdt\">自动登录</label><a href=\"javascript:void(0)\" onClick=\"fixPassword();\" class=\"faget\">忘记密码？</a></li>";
            str += "<li><input type=\"button\" value=\"登录\" class=\"lo-bt\" onClick=\"loginShop();\"/></li>";
            str += "<li class=\"athorlogin1\"><span class=\"purco\">使用PurCotton合作网站账号登录：</span>";
            str += "<a href=\"#\" class=\"lg-qq1\">QQ</a><a href=\"#\" class=\"lg-sina1\">新浪微博</a><br /><br /><a href=\"#\" class=\"lg-1391\">139邮箱</a><a href=\"#\" class=\"lg-zfb1\">支付宝</a></li>";
            str += "</ul><span class=\"b\"></span></form></div></div></div>";
            str += "<div class=\"mask-div\" id=\"mask-div\"></div>";
        $("body").append(str);
        mask_div = $$("mask-div");
        login_div = $$("login-div");
    }
    mask_div.css({
        width : document.documentElement.clientWidth + "px",
        height : document.documentElement.clientHeight + "px"
    });
    login_div.css({
        left : (document.documentElement.clientWidth - $("#login-div").width()) / 2 + "px",
        top : (document.documentElement.clientHeight - $("#login-div").height()) / 2 + "px"
    });
    var closeBtn = $$("cf_close");
    
    closeBtn.one("click", function(){
        mask_div.hide();
        login_div.hide();
    });
    
}

function loginShop2(){
    var loginForm=document.getElementById('login');
    if($.trim($("#loginName").val()) == "" || $.trim($("#loginName").val()) == null){
       $("#warn").html("用户名不能为空");
       $("#loginName").focus();
       return false;
    }
    if($.trim($("#loginPassword").val())==null || $.trim($("#loginPassword").val())==""){
       $("#warn").html("请输入密码");
       $("#loginPassword").focus();
       return false;
    }
    loginForm.submit();
    return true;
}
     
 function fixPassword(){    
     if($.trim($("#loginName").val()) == "" || $.trim($("#loginName").val()) == null){
           $("#warn").html("用户名不能为空");
           $("#loginName").focus();
           return false;
      }
     var loginForm=document.getElementById('login');
     loginForm.action="fogetPassword.ihtml";
     loginForm.submit();
 }
 
 
 function resivePassword(){
     var loginForm=document.getElementById('sendSms');
     loginForm.submit();
 }
 
 document.onkeydown = function(e){
    var ev = e || window.event;
    if(ev.keyCode == 13)
        loginShop();
};

function $$(id){
    return $(document.getElementById(id));
};



function openStockOut(){
    var mask_div = $$("mask-div"),
        clo_btn = $$("cf_close"),
        login_div = $$("login-div");
    
    var qhdj = $(".login-form1"),
        qhcl = $(".qh-loading"),
        djcg = $(".qh-finish"); 
    
    qhdj.show();
    qhcl.hide();
    djcg.hide();
    $('.finis-des em').html(3);
    mask_div.css({
        display : "block",
        width : document.documentElement.clientWidth + "px",
        height : document.documentElement.clientHeight + "px"
    });
    login_div.css({
        display : "block",
        left : (document.documentElement.clientWidth - $("#login-div").width()) / 2 + "px",
        top : (document.documentElement.clientHeight - $("#login-div").height()) / 2 + "px"
    });
    clo_btn.click(function(){
        mask_div.hide();
        login_div.hide();
    });
}


function saveStockOutRegister(){
    var qhdiv = $(".log-cent"),
    qhdj = $(".login-form1"),
    qhcl = $(".qh-loading"),
    djcg = $(".qh-finish"); 
    clearWarnInfo();
    var name = $("#name").val();
    var phone = $("#phone").val();
    var email = $("#email").val();
    var prodNo =$("#prodNo").val();
    if(name==""){
        $("#warn").html("请输入您的姓名");
        return;
    }else{
        var result = /^([\u4e00-\u9fa5]+|[a-zA-Z0-9]+)$/;
        if(!result.test(name)){
            $("#warn").html("只能输入中文姓名");
            return;
        }
    }
    if(phone==""){
        $("#warn").html("请输入您的手机号码");
        return;
    }else{
        var result=/^1[3|4|5|8][0-9]{9}$/;// 只能输入数字
        if(!result.test(phone)){
            $("#warn").html("您输入的手机号码不正确");
            $("#email").css('visibility','visible');
            return;
        }
    }
    if(email==""){
        $("#warn").html("请输入您的邮箱");
        return;
    }else{
        var result= /^[-_A-Za-z0-9]+@([_A-Za-z0-9]+.)+[A-Za-z0-9]{2,3}$/;
        if(!result.test(email)){
            $("#warn").html("您输入的邮箱格式不正确");
            $("#email").css('visibility','visible');
            return;
        }
    }
    
    var url=MallPath+"/mall/commodity/setStockOutRegister.ihtml";
    
    var params='&prodNo='+prodNo+'&name='+name+'&phone='+phone+'&email='+email;
    
    
    $.ajax({ 
        type: "POST",
        url: url,
        data: params,
        beforeSend : function(){
            qhdiv.css("height", "357px");
            qhdj.hide();
            qhcl.show();
            djcg.hide();
        },
        success: function(msg){
            if(msg=='true'){
                qhdiv.css("height", "357px");
                qhdj.hide();
                qhcl.hide();
                djcg.show();
            }else{
                alertBox('您的缺货登记失败了!');
            }
            var timer = null;
            timer = setInterval(function(){
                var _html = parseInt($('.finis-des em').html());
                $('.finis-des em').html(--_html);
                if(_html==0){
                    $('#login-div').hide();
                    $('#mask-div').hide();
                    clearInterval(timer);
                }
            }, 1000);
        }
    });
}

function clearWarnInfo(){
    $("#warn").html("");
}

//立即购买
function buynow(){
    var prodNo =$("#prodNo").val();
    
    var numobj = $('#goodsNo').val();
    var stock = $("#productStock").val();
    
    if(!isNaN(numobj)){
        
    }
    
    if(numobj<=0){
        // alertBox("请输入正确的购物数量!");
		$('body').popup({
			title: '提示信息',
			content: '请输入正确的购物数量！'
		});
        $('#goodsNo').focus();
        return;
    }
    
    if(parseInt(numobj)>parseInt(stock)){
        // alertBox("请输入小于或等于库存的购物数量!");
		$('body').popup({
			title: '提示信息',
			content: '请输入小于或等于库存的购物数量！'
		});
        $('#goodsNo').focus();return;
    }
    
        var leagueCommo ="leagueCommo";
        
        var locationUrl = window.location.href;
        var leagueCommoStr = $('#'+leagueCommo).val();
        if(typeof leagueCommoStr == "undefined" || leagueCommoStr == ""){
            if(locationUrl.indexOf("?leaguemember_Id=") != -1) {
                leagueCommoStr = locationUrl.substring(locationUrl.indexOf("?leaguemember_Id=")+17);
            }
        }
        var jiacar = $(".jiacar"),
            topCart = $(".top-cart"),
            goodsArray = [];
        var params='&prodNo='+prodNo+'&num='+numobj+'&leagueCommo='+leagueCommoStr+'&url='+window.location.href;
        $.ajax({
            url:MallPath+'/mall/order/trade/buy_now.ihtml',
            type:'POST', 
            dataType:"json",
            data: params,
            success: function(result){
                    var msg = result.data;
                    if(msg=='notlogin'){//未登录跳转至登录页面
                        // new login-wrap(zy)
                        alert_login ();
                        
//                      tipBox("网页提示","用户未登录，请先登录","我知道了",function(){
//                          window.location.href=MallPath+'/mall/memberLogin/toLogin.ihtml';
                            //$('.login-register').show();
                        $('.login-register').show();
                            var loginRegister = $(".login-register"),
                                left,
                                top,
                                clientWidth,
                                clientHeight,
                                scrollTop,
                                loginWidth;
                            //if(loginRegister.attr("display") == "none"){
                                //loginRegister.show();
                            //}else{
                                clientWidth = $(window).width();
                                clientHeight = $(window).height();
                                loginWidth = parseInt(loginRegister.width());
                                left = (clientWidth - loginWidth)/2;
                                                                
                                loginRegister.css({
                                    "position": "absolute",
                                    top: $(window).scrollTop()+50,
                                    left: left
                                }).show();
                                
                            //}
                            
                        
//                      });
                        /*alertBox("用户未登录，请先登录");
                        window.location.href=MallPath+'/mall/memberLogin/toLogin.ihtml';*/
                    }else{
                        var url=MallPath+"/mall/cart/add_cart.ihtml?sellType=1&prodNo="+prodNo+"&num="+numobj+"&leagueCommo="+leagueCommoStr;   
                        $.ajax({ 
                                    type: "POST",
                                    url: url,
                                    success: function(msg){
                                        if(msg=='success'){
                                            
                                            window.location.href=MallPath+'/mall/cart/viewMayCart.ihtml';
                                        }else{
                                            // alertBox('您选中的商品购买失败!');
											$('body').popup({
												title: '提示信息',
												content: '您选中的商品购买失败！'
											});
                                        }                       
                                    }
                        });                     
                    }
        }});    
        
}

function onNameCheck() 
{
    var re = /^[a-zA-Z][a-zA-Z0-9_]{5,16}$/;
    if ($.trim($("#userName").val()) == null || "" == $.trim($("#userName").val())) 
    {
        document.getElementById("userNameError").innerHTML = "用户名不能为空";
        $("#userName").focus();
        $("#userNameError").show();
        return false;
    } 
    else if (!re.exec($.trim($("#userName").val()))) 
    {
        document.getElementById("userNameError").innerHTML = "6~16个字符，可使用字母.数字.下划线，需以字母开头";
        $("#userNameError").show();
        $("#userName").focus();
        return false;
    } 
    else 
    {
        var flag = false;
        $.ajax({
                type : "POST",
                url : MallPath+"/mall/memberLogin/checkLoginName.ihtml?random=" + Math.random(),
                data : {
                    "loginName" : $.trim($("#userName").val())
                },
                async : false,
                dataType : "json",
                success : function(data) 
                {
                    if (data == "1") 
                    {
                        document.getElementById("userNameError").innerHTML = "该用户名已被注册，请重新输入";
                        $("#userNameError").show();
                        $("#userName").focus();
                        flag = false;
                    }
                    else
                    {
                        $("#userNameError").hide();
                        flag = true;
                    }
                }
            });
        return flag;
    }
}

function onMobileCHeck() 
{
    var re = /^0?(13|15|17|18|14)[0-9]{9}$/;
    if ($.trim($("#userMobile").val()) == null || "" == $.trim($("#userMobile").val())) 
    {
        document.getElementById("userMobileError").innerHTML = "用户手机不能为空";
        $("#userMobile").focus();
        $("#userMobileError").show();
        return false;
    } 
    else if (!re.exec($.trim($("#userMobile").val()))) 
    {
        document.getElementById("userMobileError").innerHTML = "手机号不合法";
        $("#userMobileError").show();
        $("#userMobile").focus();
        return false;
    } 
    else 
    {
        var flag = false;
        $.ajax({
                type : "POST",
                url : MallPath+"/mall/memberLogin/checkLoginName.ihtml?random=" + Math.random(),
                data : {
                      "loginName" : $.trim($("#userMobile").val())
                },
                async : false,
                dataType : "json",
                success : function(data) 
                {
                    if (data == "1") 
                    {
                        document.getElementById("userMobileError").innerHTML = "该手机号已被注册，请重新输入";
                        $("#userMobileError").show();
                        $("#userMobile").focus();
                        flag = false;
                    }
                    else
                    {
                        $("#userMobileError").hide();
                        flag = true;
                    }
                }
            });
        return flag;
    }
}

function onPwdCheck() 
{
    var password = $.trim($("#password").val());
    if (f_haveBank($("#password").val())) 
    {
        document.getElementById("returnSPwdMessage").innerHTML = "密码不能包含空格组成";
        $("#returnSPwdMessage").show();
        $("#password").focus();
        return false;
    }
    var patrn = /^(\w){6,20}$/;
    if (!patrn.exec(password)) 
    {
        document.getElementById("returnSPwdMessage").innerHTML = "密码必须为6-20个字母、数字、下划线组成";
        $("#returnSPwdMessage").show();
        $("#password").focus();
        return false;
    } 
    else 
    {
        $("#returnSPwdMessage").hide();
        return true;
    }
}

function f_haveBank(msg) {
    for ( var idx = 0; idx < msg.length; idx++) {
        if (msg.substr(idx, 1) == " ") {
            return true;
        }
    }
    return false;
}

function onPwd2CHeck() 
{
    if ($.trim($("#re_password").val()) == ""
            || $.trim($("#re_password").val()) == null) 
    {
        document.getElementById("returnSPwd2Message").innerHTML = "确认密码不可以为空!";
        $("#returnSPwd2Message").show();
        $("#re_password").focus();
        return false;
    } 
    else if ($.trim($("#password").val()) != $.trim($("#re_password").val())) 
    {
        document.getElementById("returnSPwd2Message").innerHTML = "两次密码输入不一致";
        $("#returnSPwd2Message").show();
        $("#re_password").focus();
        return false;
    }
    else 
    {
        $("#returnSPwd2Message").hide();
        return true;
    }
}

function onMsgCheck() 
{
    if ($.trim($("#viliMsg").val()) == ""|| $.trim($("#viliMsg").val()) == null) {
        document.getElementById("returnViliMsg").innerHTML = "图形验证码不可以为空";
        $("#returnViliMsg").show()
        $("#viliMsg").focus();
        return false;
    } 
    else 
    {
        var flag = true;
        $.ajax({
                type : "POST",
                url : MallPath+"/mall/memberLogin/checkVerifyMsg.ihtml?random=" + Math.random(),
                data : {
                        "validation" : $.trim($("#viliMsg").val())
                },
                async : false,
                dataType : "json",
                success : function(data) 
                {
                    if (data == "0") 
                    {
                        document.getElementById("returnViliMsg").innerHTML = "验证码错误";
                        $("#returnViliMsg").show();
                        $("#viliMsg").focus();
                        flag = false;
                    } 
                    else 
                    {
                        $("#returnViliMsg").hide();
                        return true;
                    }
                }
            });
        return flag;
    }
}

function onAgreement() 
{
    if ($("#xieyi").attr("checked") != "checked") {
        document.getElementById("returnAgreeMsg").innerHTML = "您还未接受全棉用户协议";
        $("#returnAgreeMsg").show();
        return false;
    } else {
        $("#returnAgreeMsg").hide();
        return true;
    }
}


//加载验证码
function reload() {
    var cpt = document.getElementById('vpic');
    var src = cpt.src;
    cpt.src = src + '?' + Math.random();

}

//快速注册
function gotoFastRegister() 
{
    if(onMobileCHeck()&&onPwdCheck()&&onPwd2CHeck()&&onMsgCheck()&&onMsgCodeCheck()&&onAgreement())
    {
        document.getElementById("submitShop_show").innerHTML = "<span class='button9'><b>提交中...</b></span>";
        //var loginName  = $("#userName").val();
        var password =  $("#password").val();
        var userMobile =  $("#userMobile").val();
        var msgCode =  $("#msgCode").val();
        var imgCode =  $("#viliMsg").val();
        var paramsregister = "password="+password+ "&userMobile="+userMobile+ "&msgCode="+msgCode+ "&imgCode="+imgCode;
        $.ajax({
            type: "POST",
            url: MallPath+"/mall/memberLogin/fastRegister.ihtml",
            data: paramsregister,
            cache: false,                   
            success : function(data) 
            {
                var result=eval("("+data+")");  
                if(result.success)
                {   
                    alert("恭喜你，注册成功!");
                    $('.login-register').hide();
                    window.location.reload();
                }
                else
                {
                    document.getElementById("submitShop_show").innerHTML = "<input type='button' onClick='gotoFastRegister();' value='' class='btn-register reg-bt'/>";
                    alert(result.message);
                    $("#loginName").focus();                            
                }
                
                $("#tip-box").css({
                    position: "absolute",
                    top: $(window).scrollTop()+70,
                    left: ($(window).width()- $("#tip-box").width())/2
                });
            }
        });

        //pingyou注册统计,2015-12-30 caohong
        pyRegisterCvt(loginName);
    }
}

//获取短信验证码,快速流程注册
function getMsgCode() 
{
    // 手机号验证
    var vcode = onMobileCHeck();
    var vimgcode = onMsgCheck();
    if (vcode && vimgcode) 
    {
        sendTime(document.getElementById("btnMsgCode"));
        $("#userMobile").css("cursor", 'default');
        $.ajax({
            type : "POST",
            url : MallPath+"/mall/memberLogin/sendPhoneSMSCode.ihtml?random=" + Math.random(),
            data : {
                "telephone" : $.trim($("#userMobile").val()),
                "purpose": 'Register',
                "imageCode": $.trim($("#viliMsg").val())
            },
            async : true,
            dataType : "json",
            success : function(result)
            {
                if(result.success == true)
                {
                    document.getElementById("msgCodeError").innerHTML = result.data;
                    $("#msgCodeError").css("color","#008B8B").show();
                }
                else
                {
                    document.getElementById("msgCodeError").innerHTML = result.data;
                    $("#msgCodeError").css("color","red").show();
                }
            }
        });
    } 
    else 
    {
        // alertBox("请输入有效手机号或图形验证码!");
    }
}

var wait = 120;
function sendTime(o) 
{
    if (wait == 0) 
    {
        o.removeAttribute("disabled");
        $("#btn").css({
            "width" : "90",
            "border" : "1px white solid"
        });
        o.value = "重新获取验证码";
        $("#btn").css("cursor", "pointer");
        wait = 120;
    } 
    else 
    {
        $(document).ready(function() {
            $("#btn").css({
                "width" : "100",
                "height" : "25px",
                "border" : "1px white solid"
            });
        });

        o.setAttribute("disabled", true);
        o.value = "" + wait + "s后重新获取";
        wait--;
        setTimeout(function() {
            sendTime(o);
        }, 1000);
    }
}

//短信验证码校验
function onMsgCodeCheck() 
{
    if ($.trim($("#msgCode").val()) == "" || $.trim($("#msgCode").val()) == null) 
    {
        document.getElementById("msgCodeError").innerHTML = "短信验证码不能为空";
        $("#msgCodeError").show();
        return false;
    } 
    else 
    {
        var flag = true;
        $.ajax({
            type : "POST",
            url : MallPath+"/mall/memberLogin/checkIdentifyCode.ihtml",
            data : {
                "loginName": $.trim($("#userMobile").val()),
                "code" : $.trim($("#msgCode").val())
            },
            async : false,
            dataType : "json",
            success : function(data) 
            {
                if (data == "0") 
                {
                    document.getElementById("msgCodeError").innerHTML = "短信验证码错误";
                    $("#msgCodeError").show();
                    flag = false;
                }
                else 
                {
                    $("#msgCodeError").hide();
                    return true;
                }
            }
        });
        return flag;
    }
}

//pinyou注册统计,2015-12-22 caohong
function pyRegisterCvt(_orderno)
{
    var w=window,d=document,e=encodeURIComponent;
    var b=location.href,c=d.referrer,f,g=d.cookie,h=g.match(/(^|;)\s*ipycookie=([^;]*)/),i=g.match(/(^|;)\s*ipysession=([^;]*)/);
    if (w.parent!=w){f=b;b=c;c=f;};u='//stats.ipinyou.com/cvt?a='+e('LDs.NZs.FLr3aef_G5Fz01c_dv0kb0')+'&c='+e(h?h[2]:'')+'&s='+e(i?i[2].match(/jump\%3D(\d+)/)[1]:'')+'&u='+e(b)+'&r='+e(c)+'&rd='+(new Date()).getTime()+'&OrderNo='+e(_orderno)+'&e=';
    (new Image()).src=u;
}

//快速登录
function loginShop() 
{

    if ($.trim($("#loginName").val()) == "" || $.trim($("#loginName").val()) == null) 
    {
        $("#warn2").html("请输入邮箱/用户名/已验证手机");
        $("#warnMsgLog").html("请输入登录名！");
        $("#warn2").show();
        $("#loginName").focus();
        
        return false;
    } 
    
    if ($.trim($("#loginPassword").val()) == null || $.trim($("#loginPassword").val()) == "") 
    {
        $("#warn2").html("请输入密码");
        $("#warnMsgLog").html("请输入密码！");
        $("#warn2").show();
        $("#loginPassword").focus();
        return false;
    }
    
    if ($.trim($("#imgCode2").val()) == null || $.trim($("#imgCode2").val()) == "") 
    {
        $("#warn2").html("请输入图形验证码");
        $("#warnMsgLog").html("请输入图形验证码！");
        $("#warn2").show();
        $("#imgCode2").focus();
        return false;
    }

    if ($("#zdt").attr("checked") == "checked") 
    {
        setCookie("userName", $.trim($("#loginName").val()), 24, "/");
        setCookie("password", $.trim($("#loginPassword").val()), 24, "/");
    } 
    else 
    {
        deleteCookie("userName", "/");
        deleteCookie("password", "/");
    }
    //var locationUrl = window.location.href;
    //loginForm.submit();
    
    var loginName  = $("#loginName").val();
    var password =  $("#loginPassword").val();
    var imgCode2 = $("#imgCode2").val();
    var params = "loginName="+loginName + "&loginPassword="+password+"&imgCode2="+imgCode2;
    
    $.ajax({
        type: "POST",
        url: MallPath+"/mall/memberLogin/fastLogin.ihtml",
        data: params,
        cache: false,                   
        success : function(data) 
        {
            var result=eval("("+data+")");  
            if(result.success)
            { 
                $("#warn2").hide();
                $("#warnMsgLog").hide();
                $('.login-register').hide();
                window.location.reload();
            }
            else
            {
                $("#warn2").html(result.message);
                $("#warnMsgLog").html(result.message);
                $("#warn2").show();
                $("#loginName").focus();                            
            }
        }
    });
}



function submitC()
{
    $('.login-register').show();
}

//快速登录与注册
function fastLoginAndRegister(){
        $.ajax({
            
            url:MallPath+'/mall/memberLogin/checkLogin.ihtml',
            type:'POST', 
            dataType:"json",
            success: function(result){
                    var msg = result.data;
                    if(msg=='notlogin'){
                        $('.login-register').show();
                            var loginRegister = $(".login-register"),
                                left,
                                top,
                                clientWidth,
                                clientHeight,
                                scrollTop,
                                loginWidth;
                                clientWidth = $(window).width();
                                clientHeight = $(window).height();
                                loginWidth = parseInt(loginRegister.width());
                                left = (clientWidth - loginWidth)/2;
                                                                
                                loginRegister.css({
                                    "position": "absolute",
                                    top: $(window).scrollTop()+50,
                                    left: left
                                }).show();
                    }else{
                        alert('您已登录!');
                    }
        }});    
        
}

//去购物车结算
function calculate(){

    $.ajax({
        
        url:MallPath+'/mall/memberLogin/checkLogin.ihtml',
        type:'POST', 
        dataType:"json",
        success: function(result){
                var msg = result.data;
                if(msg=='notlogin'){
                    $('.login-register').show();
                        var loginRegister = $(".login-register"),
                            left,
                            top,
                            clientWidth,
                            clientHeight,
                            scrollTop,
                            loginWidth;
                            clientWidth = $(window).width();
                            clientHeight = $(window).height();
                            loginWidth = parseInt(loginRegister.width());
                            left = (clientWidth - loginWidth)/2;
                                                            
                            loginRegister.css({
                                "position": "absolute",
                                top: $(window).scrollTop()+50,
                                left: left
                            }).show();
                }else{
                    window.location.href=MallPath+'/mall/cart/viewMayCart.ihtml';
                }
    }});    
}

//pinyou单品统计 2016 新版
function getPinyouTJ()
{
    var productId = "";
    var productState = "";
    var productTypePath = "";
    var productTypeId = "";
    var productName = "";
    var productPrice = "";
    var newProductPrice = "";
    var productImgUrl = "";
    var productUrl = window.location.href;
    
    if(document.getElementById("prodNo"))
    {
        productId = document.getElementById("prodNo").value;
    }
    if(document.getElementById("productState") && document.getElementById("productStock"))
    {
        var tmp = document.getElementById("productStock").value;
        productState = document.getElementById("productState").value;
        if(productState == "1" && tmp != "0")
        {
            productState = "0";
        }
        else
        {
            productState = "1";
        }
    }
    if(document.getElementById("productTypePath1"))
    {
        productTypePath = productTypePath + document.getElementById("productTypePath1").value + ">";
    }
    if(document.getElementById("productTypePath2"))
    {
        productTypePath = productTypePath + document.getElementById("productTypePath2").value + ">";
    }
    if(document.getElementById("productTypePath3"))
    {
        productTypePath = productTypePath + document.getElementById("productTypePath3").value;
    }
    if(document.getElementById("productTypeId"))
    {
        productTypeId = document.getElementById("productTypeId").value;
    }
    if(document.getElementById("productName"))
    {
        productName = document.getElementById("productName").value;
    }
    if(document.getElementById("productPrice"))
    {
        productPrice = document.getElementById("productPrice").value;
    }
    if(document.getElementById("newProductPrice"))
    {
        newProductPrice = document.getElementById("newProductPrice").value;
    }
    else
    {
        newProductPrice = productPrice;
    }
    if(document.getElementsByClassName("productImgUrl") && document.getElementsByClassName("productImgUrl").length > 0)
    {
        productImgUrl = document.getElementsByClassName("productImgUrl")[0].value;
    }
    //如果是商品详细页面才能获取这些数据，才发统计给pinyou
    /*
    if(productId != "" && productState != "" && productTypePath != "" && productTypeId != "" 
       && productName != "" && newProductPrice != "" && productImgUrl != "")
    {
        var _goodsData = 
        {
            id:productId, //商品ID（必填）
            soldOut:productState, // 状态 1下架，0在售（必填）
            category:productTypePath, // 所属分类完整路径 （必填）
            categoryId:productTypeId, // 所属分类ID （必填）
            name:productName, // 商品名称（必填）
            price:newProductPrice, // 商品售价（必填）
            imgUrl:productImgUrl, // 商品预览图 （必填）
            productUrl:productUrl, // 商品URL地址 （必填）
            domain:'', // 分站（如有分站必填）
            brand:'', // 商品品牌(选填)
            promotion:'', // 促销信息 (选填)
            discount:'', // 折扣数字(选填)
            origPrice:productPrice // 商品原价(选填)
        };
        
        window._py = window._py||[];
        _py.push(['a', 'LDs..Jn6TnonVYGKNTOhxcsD6jX']);
        _py.push(['domain','stats.ipinyou.com']);
        _py.push(['pi',_goodsData]);
        _py.push(['e','']);
        
        -function(d)
        {
            var s = d.createElement('script'),
            e = d.body.getElementsByTagName('script')[0]; e.parentNode.insertBefore(s, e),
            f = 'https:' == location.protocol;
            s.src = (f ? 'https' : 'http') + '://'+(f?'fm.ipinyou.com':'fm.p0y.cn')+'/j/adv.js';
        }(document);    
    }*/
    if(productId != "" && productState != "" && productTypePath != "" && productTypeId != "" 
           && productName != "" && newProductPrice != "" && productImgUrl != "")
    {
        py('event','viewItem',{
            'product_no':productId,//商品编号
            'name':productName,//商品名称
            'category':productTypePath,//所属分类完整路径（必填）
            'price':newProductPrice,//商品销售价格
            'orig_price':productPrice,//商品显示价格
            'currency_code':'',//货币类型，默认为人民币
            'product_url':productUrl,//商品链接
            'pic_width':'',//图片宽
            'pic_height':'',//图片高
            'pc_pic_url':productImgUrl,//商品图链接
            'promotion':'',//促销信息，例如：热卖,促销
            'sold_out':productState,//售空标识
            'brand':'',//品牌名称
            'discount':''//折扣
        });
    }

}

// juxiao统计
function juxiaoTongji()
{
    var productId = "";
    var productState = "";
    var productTypeId = "";
    var productName = "";
    var productPrice = "";
    var newProductPrice = "";
    var productImgUrl = "";
    var productUrl = window.location.href;
    
    if(document.getElementById("prodNo"))
    {
        productId = document.getElementById("prodNo").value;
    }
    if(document.getElementById("productState") && document.getElementById("productStock"))
    {
        var tmp = document.getElementById("productStock").value;
        productState = document.getElementById("productState").value;
        if(productState == "1" && tmp != "0")
        {
            productState = "1";
        }
        else
        {
            productState = "0";
        }
    }

    if(document.getElementById("productTypeId"))
    {
        productTypeId = document.getElementById("productTypeId").value;
    }
    if(document.getElementById("productName"))
    {
        productName = document.getElementById("productName").value;
    }
    if(document.getElementById("productPrice"))
    {
        productPrice = document.getElementById("productPrice").value;
    }
    if(document.getElementById("newProductPrice"))
    {
        newProductPrice = document.getElementById("newProductPrice").value;
    }
    else
    {
        newProductPrice = productPrice;
    }
    if(document.getElementsByClassName("productImgUrl") && document.getElementsByClassName("productImgUrl").length > 0)
    {
        productImgUrl = document.getElementsByClassName("productImgUrl")[0].value;
        productImgUrl = productImgUrl.split("_")[0];
    }
    
    var _mvq = window._mvq || []; 
    window._mvq = _mvq;
    _mvq.push(['$setAccount', 'm-141-0']);

    _mvq.push(['$setGeneral', 'goodsdetail', '', /*用户名*/ '', /*用户id*/ '']);
    _mvq.push(['$logConversion']);

    _mvq.push(['setPageUrl', /*单品着陆页url*/ productUrl]); //如果不需要特意指定单品着陆页url请将此语句删掉
    _mvq.push(['$addGoods',  /*分类id*/ productTypeId, /*品牌id*/ '', /*商品名称*/ productName,/*商品ID*/ productId,/*商品售价*/ newProductPrice, /*商品图片url*/ productImgUrl, /*分类名*/ '', /*品牌名*/ '', /*商品库存状态1或是0*/ productState, /*网络价*/ '',/*收藏人数*/ '', /*商品下架时间*/ '']);
    _mvq.push(['$logData']);

    (function() {
        var mvl = document.createElement('script');
        mvl.type = 'text/javascript'; mvl.async = true;
        mvl.src = ('https:' == document.location.protocol ? 'https://static-ssl.mediav.com/mvl.js' : 'http://static.mediav.com/mvl.js');
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(mvl, s); 
    })();
}

/**
 * 图形验证码刷新
 */
$(function(){
	$("#valiImg").click(function(){
		// 刷新验证码
	    var validImg = document.getElementById('valiImg');
	    var src = validImg.src;
	    validImg.src = src+'?'+Math.random();
	    $("#warn").html("");
	});
});


// -------------------  PC改版使用Begin  --------------------------
//加载验证码--PC改版使用
function reloadLog() {
    var cpt = document.getElementById('vpicLog');
    var src = cpt.src;
    cpt.src = src + '?' + Math.random();
}

//注册提交
function gotoRegisterForNewPC()
{
	var mobile = $("#telephone").val();
    if (mobile.length == 0)
    {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("手机号码不能为空");
        return false;
    }
    
    var password = $("#password").val();
    if (password.length == 0)
    {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("密码不能为空");
        return false;
    }
    
    var rePassword = $("#re_password").val();
    if (rePassword.length == 0) 
    {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("确认密码不可以为空!");
        return false;
    }
    
    var imageCode = $("#imageCode").val();
    if (imageCode.length == 0) 
    {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("图形验证码不可以为空!");
        return false;
    }
    
    var validateCode = $("#validateCode").val();
    if (validateCode.length == 0) 
    {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("短信验证码不可以为空!");
        return false;
    }
	
	var sTel = checkmobileForNewPC();
    var stelcode = onTelCodeForNewPC();
    var vimgcode = onMsgCheckForNewPC();

    //pingyou注册统计
    var _orderno = document.getElementById("telephone").value;
    juxiaoTongji(_orderno);

    if (sTel == true && vimgcode == true && stelcode == true ) 
    {
    	document.getElementById("submitBtn").innerHTML = "<span class='button9'><b>提交中...</b></span>";
        document.getElementById("register").submit();
        return true;
    }
}

//去siebel校验手机号是否注册，用于正常流程注册
function checkmobileForNewPC()
{
    var mobile = $("#telephone").val();
    var myreg = /^0?(13|15|17|18|14)[0-9]{9}$/;
    if (mobile.length == 0)
    {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("手机号码不能为空");
        return false;
    } 
    else if (mobile.length != 11)
    {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("请输入11位有效的手机号码");
        return false;
    } 
    else if (!myreg.test(mobile))
    {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("请输入有效手机号");
        return false;
    } 
    else
    {
        var flag = false;
        $.ajax({
            type : "POST",
            url : "checkTelephone.ihtml?",
            data : {
                "mobile" : $.trim($("#telephone").val())
            },
            async : false,
            dataType : "json",
            success : function(data) 
            {
                if (data == "1") 
                {
                	if($("#warnMsgReg").hasClass("green"))
                	{
                		$("#warnMsgReg").removeClass("green").addClass("red");
                	}
                    $("#warnMsgReg").html("您好，该手机号已注册，请<a href='toLogin.ihtml'>点击此处</a>登录！");
                    flag = false;
                }  
                else 
                {
                	$("#warnMsgReg").removeClass("red").addClass("green");
                    $("#warnMsgReg").html("该手机号可以使用");
                    flag = true;
                }
            }
        });
        return flag;
    }
}

// 短信验证码校验
function onTelCodeForNewPC()
{
    if ($.trim($("#validateCode").val()) == "" || $.trim($("#validateCode").val()) == null) 
    {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("手机验证码不能为空");
        return false;
    } 
    else 
    {
        var flag = true;
        $.ajax({
            type : "POST",
            url : "checkIdentifyCode.ihtml",
            data : {
                "loginName": $.trim($("#telephone").val()),
                "code" : $.trim($("#validateCode").val())
            },
            async : false,
            dataType : "json",
            success : function(data) 
            {
                if (data == "0") 
                {
                	if($("#warnMsgReg").hasClass("green"))
                	{
                		$("#warnMsgReg").removeClass("green").addClass("red");
                	}
                    $("#warnMsgReg").html("手机验证码错误");
                    flag = false;
                } 
                else 
                {
                	$("#warnMsgReg").removeClass("red").addClass("green");
                    $("#warnMsgReg").html("手机验证码正确");
                    return true;
                }
            }
        });
        return flag;
    }
}

//图像验证码校验
function onMsgCheckForNewPC()
{
    if ($.trim($("#imageCode").val()) == "" || $.trim($("#imageCode").val()) == null)
    {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("验证码不可以为空");
        return false;
    }
    else
    {
        var flag = true;
        $.ajax({
            type : "POST",
            url : "checkVerifyMsg.ihtml?random=" + Math.random(),
            data : {
                "validation" : $.trim($("#imageCode").val())
            },
            async : false,
            dataType : "json",
            success : function(data) 
            {
                if (data == "0") 
                {
                	if($("#warnMsgReg").hasClass("green"))
                	{
                		$("#warnMsgReg").removeClass("green").addClass("red");
                	}
                    $("#warnMsgReg").html("验证码错误");
                    flag = false;
                } 
                else 
                {
                	$("#warnMsgReg").removeClass("red").addClass("green");
                    $("#warnMsgReg").html("验证码校验成功");
                    return true;
                }
            }
        });
        return flag;
    }
}

function onPwdCheckForNewPC() {
    var password = $.trim($("#password").val());
    if (f_haveBank($("#password").val())) {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("密码不能包含空格组成");
        return false;
    }
    var patrn = /^(\w){8,20}$/;
    if (!patrn.exec(password)) {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("密码必须为8-20个字母、数字、下划线组成");
        return false;
    } else {
    	$("#warnMsg").html("");
        return true;
    }
}

function onPwd2CHeckForNewPC() {
    if ($.trim($("#re_password").val()) == "" || $.trim($("#re_password").val()) == null) {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("确认密码不可以为空!");
        return false;
    } else if ($.trim($("#password").val()) != $.trim($("#re_password").val())) {
    	if($("#warnMsgReg").hasClass("green"))
    	{
    		$("#warnMsgReg").removeClass("green").addClass("red");
    	}
        $("#warnMsgReg").html("两次密码输入不一致!");
        return false;
    } else {
    	$("#warnMsgReg").html("");
        return true;
    }
}

//获取短信验证码,普通流程注册
function getCodeForNewPC()
{
    // 手机号验证
    var vcode = checkmobileForNewPC();
    var vimgcode = onMsgCheckForNewPC();
    if (vcode && vimgcode)
    {
        timezy(document.getElementById("btn"), document.getElementById("telephone"));
        $("#btn").css("cursor", 'default');
        $.ajax({
            type : "POST",
            url : MallPath+"/mall/memberLogin/sendPhoneSMSCode.ihtml?random=" + Math.random(),
            data : {
                "telephone" : $.trim($("#telephone").val()),
                "purpose": 'Register',
                "imageCode": $.trim($("#imageCode").val())
            },
            async : true,
            dataType : "json",
            success : function(result)
            {
                if(result.success == true)
                {
                	$("#warnMsgReg").removeClass("red").addClass("green");
                    $("#warnMsgReg").html(result.data);
                }
                else
                {
                    $("#warnMsgReg").html(result.data);
                }
            }
        });
    }
    else
    {
        alert("请输入有效手机号或验证码!");
    }
}

function switchHTMLNewPC(parameter,type,obj){
    if(type == 100){
        /**原始选中数据，判断是否选中的原始数据*/
        var original = $(obj).parent().find('.hover').attr("data-value");
        if(original == parameter){
            return;
        }
        /***将原始选中的文本框去掉，将点击的文本框加上**/
        $(obj).parent().find('.hover').removeClass('hover');
        $(obj).addClass("hover");
        
        var url = MallPath+"/mall/commodity/getCommodityDetail.ihtml?prodNo=";
        var propListNos = "";
        /**通过each遍历，获得已选择的属性*/
        $("#propListId a").each(function(index, element) {
            /**获取已选中的值*/
            if($(this).hasClass('hover')){  
                propListNos = propListNos+","+$(this).attr("data-value");
            }   
        });
        propListNos =  propListNos.substring(1);
        
        var _theArray = propListNos.split(",");
        
        /**获取当前选中的属性，对应货品信息*/
        for(var i = 0;i<customProductProps.length;i++){ 
        
            var productProps = customProductProps[i];   
            var prodNo =  productProps.prodNo;          
            var number = prodNo.substring(prodNo.length-3); 
            if(null!=productProps.propsValues&&""!=productProps.propsValues){
                var propsValues = productProps.propsValues ;    
                var temp  = true;
                for ( var int = 0; int < _theArray.length; int++) { 
                    if(propsValues.indexOf(_theArray[int])<0){
                        temp = false;
                        break;
                    }
                }
                if(temp){
                    if(debug==1){
                        url = MallPath + "/detail/"+number+"/"+productProps.prodNo+".html";
						if(url.indexOf("com//") != -1)
						{
							url = url.replace("com//","com/");
						}
                        window.location.href = url;
                        return;
                    }else{
                        window.location.href = url+prodNo;
                        return;
                    }
                }
            }
        }
    }else{
        if(type==1){
            $("#colorPropNo").val(parameter);
        }else{
            $("#sizePropNo").val(parameter);
        }
    
        var prodNo = $("#prodNo").val();        //页面初始加载的货品编号
        
        var colorProp = $("#colorPropNo").val();//选中的颜色规格编号
        var sizeProp = $("#sizePropNo").val();  //选择的尺寸规格编号
        
        var url = MallPath+"/mall/commodity/getCommodityDetail.ihtml?prodNo=";
    
        for(var i = 0;i<customProductProps.length;i++){
            var productProps = customProductProps[i];
            var number = productProps.prodNo.substr(prodNo.length-3);
            if(null!=colorProp&&null!=sizeProp){
                if(productProps.colorProp!=null && productProps.sizeProp!=null){
                    if(productProps.colorProp==colorProp && productProps.sizeProp==sizeProp){
                        if(prodNo == productProps.prodNo){
                            return;
                        }
                        
                        number=productProps.prodNo.substr(productProps.prodNo.length-3);
                        if(debug==1){
                            url = MallPath + "/detail/"+number+"/"+productProps.prodNo+".html";
							if(url.indexOf("com//") != -1)
						{
							url = url.replace("com//","com/");
						}
                            window.location.href = url;
                            return;
                        }else{
                            window.location.href = url+productProps.prodNo;
                            return;
                        }
                    }
                }
            }else if (null!=colorProp){
                if(null!=productProps.colorProp&&productProps.colorProp==colorProp){
                    //alert("您选择的货品编号为："+productProps.prodNo);
                    if(prodNo == productProps.prodNo){
                        return;
                    }
                    if(debug==1){
                        url = MallPath + "/detail/"+number+"/"+productProps.prodNo+".html";
						if(url.indexOf("com//") != -1)
						{
							url = url.replace("com//","com/");
						}
                        window.location.href = url;
                        return;
                    }else{
                        window.location.href = url+productProps.prodNo;
                        return;
                    }
                }
            }else if(null!=sizeProp){
                if(null!=productProps.sizeProp&&productProps.sizeProp==sizeProp){
                    //alert("您选择的货品编号为："+productProps.prodNo);
                    if(prodNo == productProps.prodNo){
                        return;
                    }
                    if(debug==1){
                        url = MallPath + "/detail/"+number+"/"+productProps.prodNo+".html";
						if(url.indexOf("com//") != -1)
						{
							url = url.replace("com//","com/");
						}
                        window.location.href = url;
                        return;
                    }else{
                        window.location.href = url+productProps.prodNo;
                        return;
                    }
                }
            }
        }
    }
}

//-------------------  PC改版使用End  --------------------------
