
function toDetail(prodNo){ //跳转到详细页
	//window.open(MallPath+'/detail/'+prodNo+'.ihtml');
	var number = prodNo.substr(prodNo.length-3);
	var opUrl = MallPath + "/detail/"+number+"/"+prodNo+".html";
	if(undefined != debug && debug == "0"){ //0是访问动态页，1访问静态页
		opUrl = MallPath+'/mall/commodity/getCommodityDetail.ihtml?prodNo='+prodNo;
	}
	if(opUrl.indexOf("com//") != -1)
	{
		opUrl = opUrl.replace("com//","com/");
	}
	window.open(opUrl);
}


function getDetailUrl(prodNo){ //跳转到详细页
	//window.open(MallPath+'/detail/'+prodNo+'.ihtml');
	var number = prodNo.substr(prodNo.length-3);
	var opUrl = MallPath + "/detail/"+number+"/"+prodNo+".html";
	if(undefined != debug && debug == "0"){ //0是访问动态页，1访问静态页
		opUrl = MallPath+'/mall/commodity/getCommodityDetail.ihtml?prodNo='+prodNo;
	}
	if(opUrl.indexOf("com//") != -1)
	{
		opUrl = opUrl.replace("com//","com/");
	}
	return opUrl;
}

/** PC改版使用 Begin **/
function toDetailForPCNew(prodNo){ //跳转到详细页
	//window.open(MallPath+'/detail/'+prodNo+'.ihtml');
	var number = prodNo.substr(prodNo.length-3);
	var opUrl = MallPath + "/detail/"+number+"/"+prodNo+".html";
	if(undefined != debug && debug == "0"){ //0是访问动态页，1访问静态页
		opUrl = MallPath+'/mall/commodity/getCommodityDetail.ihtml?prodNo='+prodNo;
	}
	if(opUrl.indexOf("com//") != -1)
	{
		opUrl = opUrl.replace("com//","com/");
	}
	window.open(opUrl);
}


function getDetailUrlForPCNew(prodNo){ //跳转到详细页
	//window.open(MallPath+'/detail/'+prodNo+'.ihtml');
	var number = prodNo.substr(prodNo.length-3);
	var opUrl = MallPath + "/detail/"+number+"/"+prodNo+".html";
	if(undefined != debug && debug == "0"){ //0是访问动态页，1访问静态页
		opUrl = MallPath+'/mall/commodity/getCommodityDetail.ihtml?prodNo='+prodNo;
	}
	if(opUrl.indexOf("com//") != -1)
	{
		opUrl = opUrl.replace("com//","com/");
	}
	return opUrl;
}

/** PC改版使用 End **/

function showDetail(proNo){
//	alert("进来了");
//	if(undefined == debug || debug == "1"){
//		alert("静态页");
//		var number = prodNo.substr(prodNo.length-3);
//		alert(number);
//		var opUrl = MallPath + "/detail/"+number+"/"+prodNo+".html";
//	    alert(opUrl);
//		window.open(opUrl);
//		return;
//	}
	var url=MallPath;
	var url2=url+'/mall/commodity/getCommodityDetail2.ihtml?prodNo='+proNo;
//	alert(url2);
	var params={};
	$.ajax({
		  type: "post",
		  dataType: "json",
		  url: url2,
		  data: params,
		  success: function(secces){
//			  alert("secces");
				if(secces!=null && secces!=''){
	//				alert("请求数据secces");
					var obj=secces.data;
					var alldetail=[];
                    if(obj==null){
                    	alertBox("很抱歉，您来晚了，该商品卖完了");
                        return;                   	
                     }
					alldetail=obj;
					//将颜色属性取出来了
					var str="<li>";
					var str2="<li>";
					var str3="";
					
					//用户是否登录
					var item3=alldetail[2];
//                    alert(item3);   
					if(item3==null){
						$('.login-register').show();
						var loginRegister = $(".login-register"),
						    left,
						    top,
						    clientWidth,
						    clientHeight,
						    scrollTop,
						    loginWidth;
						//if(loginRegister.attr("display") == "none"){
							//loginRegister.show();
						//}else{
							clientWidth = $(window).width();
							clientHeight = $(window).height();
							loginWidth = parseInt(loginRegister.width());
							left = (clientWidth - loginWidth)/2;
															
							loginRegister.css({
								"position": "absolute",
								top: $(window).scrollTop()+50,
								left: left
							}).show();    
					   return;
					} 
					
					//将颜色取出来
						var item=alldetail[0];
						 //将尺码属性取出来
						var item2=alldetail[1];
						
						
						if(item==""){
							str+="颜色：无颜色属性";
						}else{
							str+="颜色：";
						     for(var i in item){
							   if(i==0){
						    	 var color=item[i];
							       str+='<input type="radio" name="color" checked ="checked" value="'+color.value+'">'+color.value;
						    	// str+='<a href="javascript:void(0)" class="m5 hover">'+color.value+' <i class="ie6"></i></a>';
							   }
							   else{
								   var color=item[i];
							       str+='<input type="radio" name="color"  value="'+color.value+'">'+color.value;
								  // str+='<a href="javascript:void(0)" class="m5 ">'+color.value+' <i class="ie6"></i></a>';
							   
							   }
						     
						     
						     }
//						      str+='</input></li>';
						}
						$("#detailInfo").html(str);
		    			$("#detailInfo").show();//展示确认信息
						
                   
						if(item2==""){
							str2+="尺码：无尺码属性";
						}else{
							str2+="尺码：";
						       for(var i in item2){
						    	      if(i==0){
							          var size=item2[i];
                                      str2+='<input type="radio" name="size" checked ="checked" value="'+size.value+'">'+size.value;
						    	      }
						    	      else{
						    	    	  var size=item2[i];
	                                      str2+='<input type="radio" name="size"  value="'+size.value+'">'+size.value;
							    	        
						    	      }
						    	      
						    	      
						    	      }
						       str2+='</input></li>';
						}
						var item6=alldetail[5];
						if(item6==null){
							alert("无货品信息");
						}else{
							str3+='<input type="hidden" value="'+item6+'" name="prodInfo"/>';
//							for(var i in item6){
//								var items6=item6[i];
								//可以获取到
//								for(var j in items6){
//								      alert(items6[j]);
//						        } 
//						        }
						}
						
//						alert(arr[2]);
//						alert(item6[2]);
//						alert(item[0]);  alert(item2[0]);
						if(item==""&&item2==""||item[1]==null&&item2==""||item[1]==null&&item2[1]==null||item==""&&item2[1]==null){
							var numobj = 1;
							var locationUrl = MallPath+"/mall/commodity/getCommodityDetail.ihtml?prodNo="+proNo;
		                   var params='&prodNo='+proNo+'&num='+numobj+'&url='+window.location.href;
		           		$.ajax({
		           			url:MallPath+'/mall/order/trade/buy_now.ihtml',
		           			type:'POST', 
		           			dataType:"json",
		           			data: params,
		           			success: function(result){
		           					var msg = result.data;
		           					if(msg=='notlogin'){//未登录跳转至登录页面
//		           						tipBox("网页提示","用户未登录，请先登录","我知道了",function(){
//		           							window.location.href=MallPath+'/mall/memberLogin/toLogin.ihtml';
		           							//$('.login-register').show();
		           						$('.login-register').show();
		           							var loginRegister = $(".login-register"),
		           							    left,
		           							    top,
		           							    clientWidth,
		           							    clientHeight,
		           							    scrollTop,
		           							    loginWidth;
		           							//if(loginRegister.attr("display") == "none"){
		           								//loginRegister.show();
		           							//}else{
		           								clientWidth = $(window).width();
		           								clientHeight = $(window).height();
		           								loginWidth = parseInt(loginRegister.width());
		           								left = (clientWidth - loginWidth)/2;
		           																
		           								loginRegister.css({
		           									"position": "absolute",
		           									top: $(window).scrollTop()+50,
		           									left: left
		           								}).show();
		           								
		           							//}
		           							
		           						
//		           						});
		           						/*alertBox("用户未登录，请先登录");
		           			    		window.location.href=MallPath+'/mall/memberLogin/toLogin.ihtml';*/
		           			    	}else{
		           			    		var url=MallPath+"/mall/cart/add_cart.ihtml?sellType=1&prodNo="+proNo+"&num="+numobj+"&leagueCommo=0";	
		           			    		$.ajax({ 
		           			    					type: "POST",
		           			    				  	url: url,
		           			    					success: function(msg){
		           			    				    	if(msg=='success'){
		           			    				    		
		           			    				    		window.location.href=MallPath+'/mall/cart/viewMayCart.ihtml';
		           			    				    	}else{
		           			    				    		alertBox('您选中的商品购买失败!');
		           			    				    	}				    	
		           			    					}
		           			    		});			    		
		           			    	}
		           		}}); 	
		           		
		                   return;
						}
						
						
						
//						//用户是否登录
//						var item3=alldetail[2];
//                        alert(item3);   
//						if(item3==null){
//                           alert("用户未登录");   
//						   
//						
//						} 
						
						//商品上下架状态
//						var item4=alldetail[3];
//						if(item4!=null){
//                           } 

						//没用
//						var item5=alldetail[4];
//						if(item5==null){
//                           }  
//						else{
//						}
						
						
						$("#detailInfo2").html(str2+str3);
		    			$("#detailInfo2").show();//展示确认信息
		    			$('.showDetailInfo').css('visibility','visible');
//		    			$('.all').css('visibility','hidden');
		    			
		    			var showDetailInfo = $('.showDetailInfo'),
					    left,
					    top,
					    clientWidth,
					    clientHeight,
					    scrollTop,
					    loginWidth;
					//if(loginRegister.attr("display") == "none"){
						//loginRegister.show();
					//}else{
						clientWidth = $(window).width();
						clientHeight = $(window).height();
						loginWidth = parseInt(showDetailInfo.width());
						left = (clientWidth - loginWidth)/2;
														
						showDetailInfo.css({
							"position": "absolute",
							top: $(window).scrollTop()+300,
							left: 600
						}).show();
				}
				}
		  });
}

//一键购买
function buynow2(){
	 var prodNo="";
	//size
	var size="";
	  var radio=document.getElementsByName("size");
	  for(var i=0;i<radio.length;i++){
		if(radio[i].checked==true){
			size=radio[i].value;
		  break;
		}
	  }
	//  alert(size);
	//color  
	  var color="";
	  var radio=document.getElementsByName("color");
	  for(var i=0;i<radio.length;i++){
		if(radio[i].checked==true){
			 color=radio[i].value;
		  break;
		}
	  }
	 // alert(color);
	 //根据传进来的颜色跟尺码 获取正确的货品编号 
	var prodInfo=$("input[name='prodInfo']").attr("value"); 
//	alert(prodInfo);
	var arr=prodInfo.split(",");
    
	if(size==""&&color==""){
    	alertBox("请您选择颜色和尺码");
        return;
    	//		prodNo=arr[1];
    }else if(size==""&&color!=""){
//    	alert("color不为空");
     for(var i=0;i<1000;){
//    	 alert(i);
	   if(arr[i].indexOf(color)>0){
		  
         if(arr[i+2]=="0"){	
        	 alertBox("您选择的商品已经卖完了，再去看看别的吧。");
        	 return;
          }
         else{
			   prodNo=arr[i+1];
			   break;
         } 
	}
	i=i+3;
    if(arr[i]==null){
    	break;
    }
     }
  } else if(size!=""&&color==""){
	   for(var i=0;i<1000;){
//		   alert(i);
	  if(arr[i].indexOf(size)>0){
         if(arr[i+2]=="0"){	
        	 alertBox("您选择的商品已经卖完了，再去看看别的吧。");
        	 return;
          }
         else{
			   prodNo=arr[i+1];
			   break;
         } 
	}
	i=i+3;
	if(arr[i]==null){
    	break;
    }
  }
  } else{
	   for(var i=0;i<1000;){
		  if(arr[i]==null){
			  break;
		  }
		  if(arr[i].indexOf(color)>0&&arr[i].indexOf(size)>0){
//			  alert(i);
             if(arr[i+2]=="0"){	
            	 alertBox("您选择的商品已经卖完了，再去看看别的吧。");
            	 return;
              }
             else{
  			   prodNo=arr[i+1];
  			   break;
             }
             } 
	
		i=i+3;
		if(arr[i]==null){
	    	break;
	    }
	}
  }
	$('.showDetailInfo').css('visibility','hidden');
    if(prodNo==""){
      prodNo=arr[1];
      opUrl = MallPath+'/mall/commodity/getCommodityDetail.ihtml?prodNo='+prodNo;
      window.open(opUrl);
      return;
    }
    
	//购买数量为1
	var numobj = 1;
		var locationUrl = MallPath+"/mall/commodity/getCommodityDetail.ihtml?prodNo="+prodNo;
		var params='&prodNo='+prodNo+'&num='+numobj+'&url='+window.location.href;
		$.ajax({
			url:MallPath+'/mall/order/trade/buy_now.ihtml',
			type:'POST', 
			dataType:"json",
			data: params,
			success: function(result){
					var msg = result.data;
					if(msg=='notlogin'){//未登录跳转至登录页面
//						tipBox("网页提示","用户未登录，请先登录","我知道了",function(){
//							window.location.href=MallPath+'/mall/memberLogin/toLogin.ihtml';
							//$('.login-register').show();
						$('.login-register').show();
							var loginRegister = $(".login-register"),
							    left,
							    top,
							    clientWidth,
							    clientHeight,
							    scrollTop,
							    loginWidth;
							//if(loginRegister.attr("display") == "none"){
								//loginRegister.show();
							//}else{
								clientWidth = $(window).width();
								clientHeight = $(window).height();
								loginWidth = parseInt(loginRegister.width());
								left = (clientWidth - loginWidth)/2;
																
								loginRegister.css({
									"position": "absolute",
									top: $(window).scrollTop()+50,
									left: left
								}).show();
								
							//}
							
						
//						});
						/*alertBox("用户未登录，请先登录");
			    		window.location.href=MallPath+'/mall/memberLogin/toLogin.ihtml';*/
			    	}else{
			    		var url=MallPath+"/mall/cart/add_cart.ihtml?sellType=1&prodNo="+prodNo+"&num="+numobj+"&leagueCommo=0";	
			    		$.ajax({ 
			    					type: "POST",
			    				  	url: url,
			    					success: function(msg){
			    				    	if(msg=='success'){
			    				    		
			    				    		window.location.href=MallPath+'/mall/cart/viewMayCart.ihtml';
			    				    	}else{
			    				    		alertBox('您选中的商品购买失败!');
			    				    	}				    	
			    					}
			    		});			    		
			    	}
		}}); 	
		
}

//function msover(){
//	alert("进来了");
//	$('.btn-ok').css('background-color','#00AAA1');
//	
//}
//function msout(){
//	$('.btn-ok').css('background-color', '#D1FAE8');
//}


function quxiao(){
	$('.showDetailInfo').css('visibility','hidden');
}



