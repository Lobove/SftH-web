// JavaScript Document
$(function(){
	
	//左右轮换
	
	qh();
	
	
	//放大镜
	jqzoom();
	
	function jqzoom(){
		var samllImg=$('#samllImg');
		samllImg.after('<span class="mark"></span>');
		samllImg.after('<span class="float_layer"></span>');
		var zodiv=$('.jqzoomdiv');
		var omak=$('.mark');
		var box=$('.jqzoom');
		var smalls=$('.goodsbigbox');
		var olayer=$('.float_layer');
		var bigimg=$('.jqzoomdiv img');
		var bigimgsrc=$('#samllImg').attr('jqimg');
		bigimg.attr('src',bigimgsrc)
		//console.log(bigimgsrc);
		omak.hover(function(){
			olayer.css('display','block');
			zodiv.css('display','block');
			bigimgsrc=$('#samllImg').attr('jqimg');
			$('.jqzoomdiv img').attr('src',bigimgsrc);
			
			
		},function(){
			olayer.css('display','none');
			zodiv.css('display','none');
		});
		omak.mousemove(function(e){
			var oEvent=e||event;
			var l=e.pageX-box.offset().left-olayer.width()/2;
			var t=e.pageY-box.offset().top-olayer.height()/2;;
			if(l<0){
				l=0;
			}
			if(l>box.width()-olayer.width()){
				l=box.width()-olayer.width()-4;
			}
			if(t<0){
				t=0;
			}
			if(t>box.height()-olayer.height()){
				t=box.height()-olayer.height()-4;
			}
			olayer.css({left:l+'px',top:t+'px'});
			var prenX=l/(smalls.width()-olayer.width());
			var prenY=t/(smalls.height()-olayer.height());
			//document.title=prenX+"|"+prenY;
			bigimg.css({left:-prenX*(bigimg.width()-zodiv.width())+'px',top:-prenY*(bigimg.height()-zodiv.height())+'px'})
			
		});
	}
	
	//选尺码
	var js_cmA=$('.js-cm a');
	var js_colorA=$('.js-color a');
	var js_sizeA = $('.js-size a');
	chose(js_cmA);
	chose1(js_colorA);
	chose1(js_sizeA);
	function chose(chose){
		chose.bind('click',function(){
			var _thisIndex=chose.index(this);
			chose.removeClass('hover').eq(_thisIndex).addClass('hover');
		});
	}
	function chose1(chose){
		chose.bind('click',function(){
			var _thisIndex=chose.index(this);
			chose.removeClass('hover').eq(_thisIndex).addClass('hover');
			//$('.slides ul').hide().removeClass('nowss').eq(_thisIndex).show().addClass('nowss');
				//var src=$(this).attr('jszoov');
				//('#samllImg').attr('src',src);
			jqzoom();
			qh();
		});
	}
	
	//推荐搭配
	var js_goodus10=$('.js-goodus10 li');
	var js_goodus10c=$('.js-goodus10c');
	js_goodus10.click(function(){
		js_goodus10.removeClass('hover');
		$(this).addClass('hover');
		var index=js_goodus10.index(this);
		js_goodus10c.hide().eq(index).show();
	});
	
	//商品介绍，规格参数，包装清单等的浮动效果
	if($(".js-goodus101")[0]){
		var goodsTop = $(".js-goodus101").offset().top;
		var goodsLeft = $(".js-goodus101").offset().left;
		var goodusLi = $(".js-goodus101").find("li");
		goodusLi.click(function(){
			if($(window).scrollTop() > goodsTop)
				$(window).scrollTop(goodsTop - 10);
		});
		$(window).scroll(function(){
			var st = $(window).scrollTop();
			if(st >= goodsTop){
				$(".js-goodus101").css({
					'position' : 'fixed',
					'top' : 0,
					'left' : goodsLeft + 'px',
					'width' : 788 + 'px',
					'z-index' : 999
				});
				$(".js-goodus101 a.jrcar").show().mouseenter(function(){$(".js-goodus101 .goodsbox").show()});
				$(".js-goodus101 .goodsbox").mouseleave(function(){$(this).hide()});
			}
			else{
				$(".js-goodus101").removeAttr('style');
			}
		});
	} 
	
	//评论
	var li_click=$('.goodusxq li');
	$('.gd-tab').eq(0).show();
	var li_con=$('.gd-tab');
	li_click.click(function(){
		//[0,1,2,3]
		//var CommentsState_vlue=$('#CommentsState').val();
		var index=li_click.index(this);
		
		if(index==0){
			$('#CommentsState').val(0);
		}
		/*else if(index==1){
			$('#CommentsState').val(index);
		}else if(index==3){
			$('#CommentsState').val(1);
		}*/
		else{
			$('#CommentsState').val(index);
		}
		li_click.removeClass('hover').eq(index).addClass('hover');
		
		pageNoClick(1,"pageComent");
		//li_con.hide().eq(index).show();
		
	});
	
	//目的地
	$('.kd1s').hover(function(){
		$('.kd1s span').show();
		$('.kd1s a').click(function(){
			var index=$('.kd1s a').index(this);
			$('.kd1s i').text($(this).text());
			$('.kd1s span').hide();
		});
	},function(){
			$(this).find('span').hide();
	});
	
	$('.js-goodus101 li').click(function(){
		var i=$('.js-goodus101 li').index(this);
		$('.js-goodus101 li').removeClass('hover');
		$(this).addClass('hover');
		$('.l-tab').hide().eq(i).show();
		if($(this).html()=="商品评价"){
			document.getElementById("fwcn_").style.display="none";
			document.getElementById("wxts_").style.display="none";
		}else{
			document.getElementById("fwcn_").style.display="block";
			document.getElementById("wxts_").style.display="block";
		}
	});
	
});
function qh(){
		var prev=$('.prev');
		var next=$('.next');
		var oul=$('.nowss');
		var olis=$('.nowss li');
		var liWidth=63;
		var now=0;
		var prentWidth=$('.nowss').width();
		var len=$('.nowss li').length;
		$('.nowss').width(len*liWidth);
		var oulWidth=$('.nowss').width();
		var widthCha=oulWidth-prentWidth;
		var bigshow=$('#samllImg');
		next.click(function(){
			if(now==len-1){
				now=0;
			}else{
				now++;
			}
			tshow(now);
		});
		
		prev.click(function(){
			if(now==0){
				now=len-1;
			}else{
				now--;
			}
			tshow(now);
		});
		olis.click(function(){
			now=$('.nowss li').index(this);
			tshow(now);
		});
		function tshow(i){
			$('.nowss li').removeClass('hover').eq(i).addClass('hover');
			if(now*liWidth<widthCha){
				$('.nowss').css({left:-now*liWidth+'px'});
				
			}else{
				$('.nowss').css({left:-widthCha+'px'});
				
			}
			
			var src=olis.eq(i).attr('jslogsrc');
			var jqzoomsrc=olis.eq(i).attr('jqimg');
			bigshow.attr('src',src);
			bigshow.attr('jqimg',jqzoomsrc);
		}
	}

/* 
 * toall:总评价条数
 * */
function hping(toall,haop,zhongp,chap){
	var str0,str1,str2;
	if(toall=="0"){
		str0=0;
		str1=0;
		str2=0;
	}else{
		str0=(haop/toall).toFixed(2)*100;
		str1=(zhongp/toall).toFixed(2)*100;
		str2=(chap/toall).toFixed(2)*100;
		if(str0+str1+str2>100){
			str2 = Math.floor((chap/toall)*100);
		}
	}
	var goodsbx=$('.goodsbx');
	var str=[str0,str1,str2];
	$('.numb').each(function(i){
		$('.numb').eq(i).text(Math.ceil(str[i]));
		goodsbx.find('i').eq(i).animate({width:Math.ceil(str[i]/100*230)+'px'},2000);
		if(i==0){
			$('.numbone').text(Math.ceil(str0)+'%');
		}
	});
}

function createMask(){
	if(document.getElementById("mask")){
		$(document.getElementById("mask")).show();
	}else{
		var c_w = document.documentElement.clientWidth;
		var c_h = document.documentElement.clientHeight;
		var kfzx = $("#kfzx");
		var kfzx_w = kfzx.width();
		var kfzx_h = kfzx.height();
		kfzx.css({left:(c_w - kfzx_w)/2 + "px", top:(c_h - kfzx_h)/2 + "px"});
		kfzx.parent().append("<div id=\"mask\" class=\"mask\" style=\"width:" + c_w + "px; height:" + c_h +"px\">dfd</div>");
	}
}

//点击评论
function showPL(){
	$('.gd-tab').eq(0).show();
	var li_con=$('.gd-tab');
	var li_click=$('.goodusxq li');
	var index=li_click.index(this);
	if(index==0){
		$('#CommentsState').val(0);
	}
	else{
		$('#CommentsState').val(index);
	}
	pageNoClick(1,"pageComent");
	
	var i=$('.js-goodus101 li').index(this);
	$('.js-goodus101 li').removeClass('hover');
	$('.l-tab').hide().eq(i).show();
	
	//滚动条滚动到离顶部670xp的距离
	$('body,html').animate({scrollTop:800},500); 
	
}

//隐藏物流运费
/*$('div[class=goods-tite] ul li').each(function(){
	if($(this).html().indexOf('物流运费') != -1){
		$(this).hide();
	}
});*/