document.onreadystatechange = function()
{
    if (document.readyState == "complete")
    {
        selectVerifyType();
    }
};

/**
 * 图形验证码刷新
 */
$(function(){
	$("#valiImg").click(function(){
		// 刷新验证码
	    var validImg = document.getElementById('valiImg');
	    var src = validImg.src;
	    validImg.src = src+'?'+Math.random();
	    $("#warn").html("");
	});
});

var wait2 = 120;
function time2(o)
{

    if (wait2 == 0)
    {
        o.removeAttribute("disabled");
        $("#btn").css(
        {
            "width" : "90",
            "border" : "1px white solid"
        });
        o.value = "重新获取验证码";
        wait2 = 120;
    }
    else
    {
        $(document).ready(function()
        {
            $("#btn").css(
            {
                "width" : "100",
                "height" : "25px",
                "border" : "1px white solid"
            });
        });

        o.setAttribute("disabled", true);
        o.value = "" + wait2 + "s后重新获取";
        wait2--;
        setTimeout(function()
        {
            time2(o);
        }, 1000);
    }
}

//登录校验
function loginShop()
{
	$("#logErrMsg").html("");
    var loginForm = document.getElementById('login');
    if ($.trim($("#loginName").val()) == "" || $.trim($("#loginName").val()) == null)
    {
        $("#warn").html("请输入邮箱/用户名/已验证手机");
        $("#warnMsgLog").html("请输入登录名！");
        $("#warn").show();
        $("#loginName").focus();
        return false;
    }
  
    if ($.trim($("#loginPassword").val()) == null || $.trim($("#loginPassword").val()) == "")
    {
        $("#warn").html("请输入密码");
        $("#warnMsgLog").html("请输入密码！");
        $("#warn").show();
        $("#loginPassword").focus();
        return false;
    }
    
    if ($.trim($("#imgCode2").val()) == null || $.trim($("#imgCode2").val()) == "")
    {
        $("#warn").html("请输入图形验证码");
        $("#warnMsgLog").html("请输入图形验证码！");
        $("#warn").show();
        $("#imgCode2").focus();
        return false;
    }
    
    loginForm.submit();
    if ($("#zdt").attr("checked") == "checked")
    {
        setCookie("userName", $.trim($("#loginName").val()), 24, "/");
        setCookie("password", $.trim($("#loginPassword").val()), 24, "/");
    }
    else
    {
        deleteCookie("userName", "/");
        deleteCookie("password", "/");
    }

    return true;
}

function fixPassword()
{
    var loginForm = document.getElementById('login');
    loginForm.action = "fogetPassword.ihtml";
    loginForm.submit();
}

function intoEmail(email)
{
    // var url ="www."+email;

    window.location.href = 'http://www.' + email;
}

function onCodeCheck()
{
    if ($.trim($("#code").val()) == "" || $.trim($("#code").val()) == null)
    {
        document.getElementById("codeError").innerHTML = "验证码不可以为空!";
        $("#codeError").show();
        return false;
    }
    else
    {
        var flag = false;
        $.ajax(
        {
            type : "POST",
            url : "checkIdentifyCode.ihtml?random=" + Math.random(),
            data :
            {
                "loginName" : $.trim($("#telPhone").val()),
                "code" : $.trim($("#code").val())
            },
            async : false,
            dataType : "json",
            success : function(data)
            {
                if (data == "1")
                {
                    document.getElementById("codeError").innerHTML = "验证通过!";
                    $("#codeError").show();
                    flag = true;
                }
                else
                {
                    document.getElementById("codeError").innerHTML = "验证不通过!";
                    $("#codeError").show();
                    flag = false;
                }
            }
        });
        return flag;
    }
}

function getCode()
{
    var vName = onNameCheck();
    if (vName)
    {
        $.ajax(
        {
            type : "POST",
            url : "sendPhoneSMSCode.ihtml?random=" + Math.random(),
            data :
            {
                "loginName" : $.trim($("#telPhone").val())
            },
            async : false,
            dataType : "json",
            success : function(result)
            {
                if (result.success == true)
                {
                    document.getElementById("checktelephone").innerHTML = result.data;
                    $("#checktelephone").css("color", "#ccc").show();
                }
                else
                {
                    document.getElementById("checktelephone").innerHTML = result.data;
                    $("#checktelephone").css("color", "red").show();
                }
            }
        });
    }
}

function onNameCheck()
{
    // var re = /^1[3|4|5|8][0-9]{9}$/;// 只能输入数字
    if ($.trim($("#telPhone").val()) == null || "" == $.trim($("#telPhone").val()))
    {
        document.getElementById("userNameError").innerHTML = "登录名不能为空！";
        $("#userNameError").show();
        return false;
    }
    /*
     * } else if (strlen($.trim($("#userName").val())) < 11) { document.getElementById("userNameError").innerHTML =
     * "用户名长度不能小于11位!"; $("#userNameError").show(); return false;
     */
    // } else if (!re.test($("#telPhone").val())) {
    // document.getElementById("userNameError").innerHTML = "格式不符，必须11位手机号码!";
    // $("#userNameError").show();
    // return false;
    // }
    return true;
}

function checkName()
{
    var email = $("#telPhone").val();
    var re = /^[-_A-Za-z0-9]+@([_A-Za-z0-9]+.)+[A-Za-z0-9]{2,3}$/;
    if (email == "")
    {
        document.getElementById("userNameError").innerHTML = "用户名不能为空！";
        $("#userNameError").show();
        return false;
    }
    else if (!re.test($("#telPhone").val()))
    {
        document.getElementById("userNameError").innerHTML = "邮件格式不符";
        $("#userNameError").show();
        return false;
    }
    return true;
}

function checkName2()
{
    var re = /^[a-zA-Z][a-zA-Z0-9_]{5,16}$/;
    if ($.trim($("#userName").val()) == null || "" == $.trim($("#userName").val()))
    {
        document.getElementById("userNameError").innerHTML = "用户名不能为空";
        $("#userNameError").show();
        return false;
    }
    else if (!re.exec($.trim($("#userName").val())))
    {
        document.getElementById("userNameError").innerHTML = "6~16个字符，可使用字母.数字.下划线，需以字母开头";
        $("#userNameError").show();
        return false;
    }
    else
    {
        $("#userNameError").hide();
        return true;
    }
}

document.onkeydown = function(e)
{
    var ev = e || window.event;
    if (ev.keyCode == 13)
    {
        loginShop();
    }
};

function displayTel()
{
    $("#info2").show();
}

function hideTel()
{
    $("#info2").hide();
}

// function resivePassword() {
//
// if (document.getElementsByName("radio")[0].checked) {
// if (checkName2()) {
// sendSms.action = "sendMesFindPass.ihtml";
// } else {
// return false;
// }
// } else {
// if (checkName2() && validatemobile2()) {
// sendSms.action = "sendMobilePass.ihtml";
// }else{
// return false;
// }
// }
//
// document.sendSms.submit();
//
// }

function selectVerifyType()
{
    var phone = $("#telephone").val();
    var email = $("#email").val();
    if ($.trim(phone) != null && !$.trim(phone) == "")
    {
        var mphone = phone.substr(3, 5);
        var lphone = phone.replace(mphone, "*****");
        $("#phone").attr("value", lphone);
    }

    if ($.trim(email) != null && !$.trim(email) == "")
    {
        var memail = email.substr(2, 5);
        var lemail = email.replace(memail, "*****");
        $("#email2").attr("value", lemail);
    }

    if (document.getElementById("selectValidType") == null)
    {
        return;
    }
    else if (document.getElementById("selectValidType").value == 1)
    {
        document.getElementById("nextbtn").innerHTML = "下一步";
        $("#emailValid").hide();
        $("#telephoneValid").show();
        document.getElementById("nextbtn").onclick = function()
        {
            $("#updatepassword").attr("action", MallPath + "/mall/memberLogin/toUpdatePassword2.ihtml");
            var sUpdate = updatepasswords();
            if (sUpdate == true)
            {
                $("#updatepassword").submit();
            }
        };

    }
    else
    {
        document.getElementById("nextbtn").innerHTML = "发送邮件";
        $("#telephoneValid").hide();
        $("#emailValid").show();
        var username = document.getElementById("username").value;
        document.getElementById("nextbtn").onclick = function()
        {
            $("#updatepassword").attr("action",
                    MallPath + "/mall/memberLogin/sendMesFindPass.ihtml?telPhone=" + username);
            $("#updatepassword").submit();
        };
    }

}

function resivePassword()
{
    var sName = onNameCheck();
    if (sName)
    {
        var loginForm = document.getElementById('sendSms');
        loginForm.submit();
    }

}

function validatemobile2()
{
    var tel = $("#tel").val();
    var myreg = /^0?(13|15|17|18|14)[0-9]{9}$/;
    if (tel.length == 0)
    {
        document.getElementById("identifyCode").innerHTML = "手机号码不能为空";
        $("#identifyCode").show();
        document.register.tel.focus();
        return false;
    }
    else if (tel.length != 11)
    {
        document.getElementById("identifyCode").innerHTML = "请输入11位有效的手机号码";
        $("#identifyCode").show();
        document.register.tel.focus();
        return false;
    }
    else if (!myreg.test(tel))
    {
        document.getElementById("identifyCode").innerHTML = "请输入有效手机号";
        $("#identifyCode").show();
        document.register.tel.focus();
        return false;
    }
    else
    {
        $("#identifyCode").hide();
        return true;
    }
}

function findUser()
{
    $("#nullError").hide();
    var loginForm = document.getElementById('sendSms');
    if ($.trim($("#username").val()) == "" || $.trim($("#username").val()) == null)
    {
        $("#userNameError").html("请填写您的用户名/已验证手机/邮箱");
        $("#userNameError").show();
        $("#username").focus();
        return false;
    }
    else
    {
        var telre = /^0?(13|15|17|18|14)[0-9]{9}$/;
        var emailre = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
        var loginTest = $.trim($("#username").val());
        var flag = true;
        $.ajax(
        {
            type : "POST",
            url : "checkLoginName.ihtml?random=" + Math.random(),
            data :
            {
                "loginName" : $.trim($("#username").val())
            },
            async : false,
            dataType : "json",
            success : function(data)
            {
                if (data == "1")
                {
                    $("#userNameError").hide();
                }
                else
                {
                    if (emailre.exec(loginTest))
                    {
                        $.ajax(
                        {
                            type : "POST",
                            url : "checkEmail.ihtml?random=" + Math.random(),
                            data :
                            {
                                "email" : $.trim($("#username").val())
                            },
                            async : false,
                            dataType : "json",
                            success : function(data)
                            {
                                if (data == "1")
                                {
                                    $("#userNameError").hide();
                                }
                                else
                                {
                                    $("#userNameError").html("您输入的账户名不存在,请核对后重新输入");
                                    $("#userNameError").show();
                                    $("#username").focus();
                                    flag = false;
                                    return flag;
                                }
                            }
                        });
                    }
                    else if (telre.exec(loginTest))
                    {
                        $.ajax(
                        {
                            type : "POST",
                            url : "checkTelephone.ihtml?",
                            data :
                            {
                                "mobile" : $.trim($("#username").val())
                            },
                            async : false,
                            dataType : "json",
                            success : function(data)
                            {
                                if (data == "1")
                                {
                                    $("#userNameError").hide();
                                }
                                else
                                {
                                    $("#userNameError").html("您输入的账户名不存在,请核对后重新输入");
                                    $("#userNameError").show();
                                    $("#username").focus();
                                    flag = false;
                                    return flag;
                                }
                            }
                        });
                    }
                    else
                    {
                        $("#userNameError").html("您输入的账户名不存在,请核对后重新输入");
                        $("#userNameError").show();
                        $("#username").focus();
                        flag = false;
                        return flag;
                    }

                }

            }
        });

        if (flag)
        {
            loginForm.submit();
        }
        return true;
    }
}

// 找回密码下一步
function updatepasswords()
{
    var imgCode = onMsgCheck();
    var stelcode = onTelCode2();
    if (imgCode == true && stelcode == true)
    {
        // document.getElementById("updatepassword").submit();
        var loginForm = document.getElementById('updatepassword');
        loginForm.submit();
    }

}

//加载验证码
function reload() {
    var cpt = document.getElementById('vpic');
    var src = cpt.src;
    cpt.src = src + '?' + Math.random();
}

//加载验证码--PC改版使用
function reloadLog() {
    var cpt = document.getElementById('vpicLog');
    var src = cpt.src;
    cpt.src = src + '?' + Math.random();
}

// 图像验证码校验
function onMsgCheck() 
{
    if ($.trim($("#imageCode").val()) == "" || $.trim($("#imageCode").val()) == null) 
    {
        document.getElementById("returnViliMsg").innerHTML = "验证码不可以为空";
        $("#returnViliMsg").css("color", "red").show();
        return false;
    } 
    else 
    {
        var flag = true;
        $.ajax({
            type : "POST",
            url : "checkVerifyMsg.ihtml?random=" + Math.random(),
            data : {
                "validation" : $.trim($("#imageCode").val())
            },
            async : false,
            dataType : "json",
            success : function(data) 
            {
                if (data == "0") 
                {
                    document.getElementById("returnViliMsg").innerHTML = "验证码错误";
                    $("#returnViliMsg").css("color", "red").show();
                    flag = false;
                } 
                else 
                {
                    document.getElementById("returnViliMsg").innerHTML = "校验成功";
                    $("#returnViliMsg").css("color", "#008B8B").show();
                    return true;
                }
            }
        });
        return flag;
    }
}

// 找回密码获取短信验证码
function getCode2()
{
    var imgCode = onMsgCheck();
    if(imgCode)
    {
        time2(document.getElementById("btn"));
        $("#btn").css("cursor", 'default');
        $.ajax(
        {
            type : "POST",
            url : "sendPhoneSMSCode.ihtml?random=" + Math.random(),
            data :
            {
                "telephone" : $.trim($("#telephone").val()),
                "purpose" : 'findPassword',
                "imageCode": $.trim($("#imageCode").val())
            },
            async : true,
            dataType : "json",
            success : function(result)
            {
                if (result.success == true)
                {
                    document.getElementById("checktelephone").innerHTML = result.data;
                    $("#checktelephone").css("color", "#008B8B").show();
                }
                else
                {
                    document.getElementById("checktelephone").innerHTML = result.data;
                    $("#checktelephone").css("color", "red").show();
                }
            }
        });
    }
    else
    {
        alertBox("请输入有效验证码");
    }
}

// 手机验证码校验
function onTelCode2()
{
    if ($.trim($("#validateCode").val()) == "" || $.trim($("#validateCode").val()) == null)
    {
        document.getElementById("checktelephone").innerHTML = "手机验证码不能为空";
        $("#checktelephone").show();
        return false;
    }
    else
    {
        var flag = false;
        $.ajax(
        {
            type : "POST",
            url : "checkVerifyTelCode.ihtml?random=" + Math.random(),
            data :
            {
                "validationTel" : $.trim($("#validateCode").val()),
                "mobilePhone" : $.trim($("#telephone").val())
            },
            async : false,
            dataType : "json",
            success : function(data)
            {
                if (data == "1")
                {
                    document.getElementById("checktelephone").innerHTML = "<font style='color:green;'>手机验证码正确</font>";
                    flag = true;
                }
                else
                {
                    document.getElementById("checktelephone").innerHTML = "手机验证码错误";
                    $("#checktelephone").show();
                    flag = false;
                }
            }
        });
        return flag;
    }

}